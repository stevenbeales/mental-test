<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class RSpec::Mocks::MessageExpectation - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../../Object.html">Object</a>
  
</div>

    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="MessageExpectation/ImplementationDetails.html">RSpec::Mocks::MessageExpectation::ImplementationDetails</a>
  
  
  </ul>
</div>

    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-and_call_original">#and_call_original</a>
    
    <li ><a href="#method-i-and_raise">#and_raise</a>
    
    <li ><a href="#method-i-and_return">#and_return</a>
    
    <li ><a href="#method-i-and_throw">#and_throw</a>
    
    <li ><a href="#method-i-and_wrap_original">#and_wrap_original</a>
    
    <li ><a href="#method-i-and_yield">#and_yield</a>
    
    <li ><a href="#method-i-at_least">#at_least</a>
    
    <li ><a href="#method-i-at_most">#at_most</a>
    
    <li ><a href="#method-i-exactly">#exactly</a>
    
    <li ><a href="#method-i-inspect">#inspect</a>
    
    <li ><a href="#method-i-never">#never</a>
    
    <li ><a href="#method-i-once">#once</a>
    
    <li ><a href="#method-i-ordered">#ordered</a>
    
    <li ><a href="#method-i-thrice">#thrice</a>
    
    <li ><a href="#method-i-times">#times</a>
    
    <li ><a href="#method-i-to_s">#to_s</a>
    
    <li ><a href="#method-i-twice">#twice</a>
    
    <li ><a href="#method-i-with">#with</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-RSpec::Mocks::MessageExpectation">
  <h1 id="class-RSpec::Mocks::MessageExpectation" class="class">
    class RSpec::Mocks::MessageExpectation
  </h1>

  <section class="description">
    
<p>Represents an individual method stub or message expectation. The methods
defined here can be used to configure how it behaves. The methods return
`self` so that they can be chained together to form a fluent interface.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-and_call_original" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">and_call_original</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Tells the object to delegate to the original unmodified method when it
receives the message.</p>

<p>@note This is only available on partial doubles.</p>

<p>@return [nil] No further chaining is supported after this. @example</p>

<pre class="ruby"><span class="ruby-identifier">expect</span>(<span class="ruby-identifier">counter</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">increment</span>).<span class="ruby-identifier">and_call_original</span>
<span class="ruby-identifier">original_count</span> = <span class="ruby-identifier">counter</span>.<span class="ruby-identifier">count</span>
<span class="ruby-identifier">counter</span>.<span class="ruby-identifier">increment</span>
<span class="ruby-identifier">expect</span>(<span class="ruby-identifier">counter</span>.<span class="ruby-identifier">count</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">eq</span>(<span class="ruby-identifier">original_count</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)
</pre>
          
          

          
          <div class="method-source-code" id="and_call_original-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rspec-mocks-3.7.0/lib/rspec/mocks/message_expectation.rb, line 97</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">and_call_original</span>
  <span class="ruby-identifier">wrap_original</span>(<span class="ruby-identifier">__method__</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">original</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">original</span>.<span class="ruby-identifier">call</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-and_raise" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">and_raise</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@overload <a
href="MessageExpectation.html#method-i-and_raise">#and_raise</a> @overload
<a
href="MessageExpectation.html#method-i-and_raise">#and_raise</a>(ExceptionClass)
@overload <a
href="MessageExpectation.html#method-i-and_raise">#and_raise</a>(ExceptionClass,
message) @overload <a
href="MessageExpectation.html#method-i-and_raise">#and_raise</a>(exception_instance)</p>

<p>Tells the object to raise an exception when the message is received.</p>

<p>@return [nil] No further chaining is supported after this. @note</p>

<pre>When you pass an exception class, the MessageExpectation will raise
an instance of it, creating it with `exception` and passing `message`
if specified.  If the exception class initializer requires more than
one parameters, you must pass in an instance and not the class,
otherwise this method will raise an ArgumentError exception.</pre>

<p>@example</p>

<pre class="ruby"><span class="ruby-identifier">allow</span>(<span class="ruby-identifier">car</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">go</span>).<span class="ruby-identifier">and_raise</span>
<span class="ruby-identifier">allow</span>(<span class="ruby-identifier">car</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">go</span>).<span class="ruby-identifier">and_raise</span>(<span class="ruby-constant">OutOfGas</span>)
<span class="ruby-identifier">allow</span>(<span class="ruby-identifier">car</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">go</span>).<span class="ruby-identifier">and_raise</span>(<span class="ruby-constant">OutOfGas</span>, <span class="ruby-string">&quot;At least 2 oz of gas needed to drive&quot;</span>)
<span class="ruby-identifier">allow</span>(<span class="ruby-identifier">car</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">go</span>).<span class="ruby-identifier">and_raise</span>(<span class="ruby-constant">OutOfGas</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">2</span>, :<span class="ruby-identifier">oz</span>))
</pre>
          
          

          
          <div class="method-source-code" id="and_raise-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rspec-mocks-3.7.0/lib/rspec/mocks/message_expectation.rb, line 139</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">and_raise</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">raise_already_invoked_error_if_necessary</span>(<span class="ruby-identifier">__method__</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">terminal_implementation_action</span> = <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> { <span class="ruby-identifier">raise</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) }
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-and_return" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">and_return</span><span
            class="method-args">(first_value, *values)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@overload <a
href="MessageExpectation.html#method-i-and_return">#and_return</a>(value)
@overload <a
href="MessageExpectation.html#method-i-and_return">#and_return</a>(first_value,
second_value)</p>

<p>Tells the object to return a value when it receives the message.  Given
more than one value, the first value is returned the first time the message
is received, the second value is returned the next time, etc, etc.</p>

<p>If the message is received more times than there are values, the last value
is received for every subsequent call.</p>

<p>@return [nil] No further chaining is supported after this. @example</p>

<pre class="ruby"><span class="ruby-identifier">allow</span>(<span class="ruby-identifier">counter</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">count</span>).<span class="ruby-identifier">and_return</span>(<span class="ruby-value">1</span>)
<span class="ruby-identifier">counter</span>.<span class="ruby-identifier">count</span> <span class="ruby-comment"># =&gt; 1</span>
<span class="ruby-identifier">counter</span>.<span class="ruby-identifier">count</span> <span class="ruby-comment"># =&gt; 1</span>

<span class="ruby-identifier">allow</span>(<span class="ruby-identifier">counter</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">count</span>).<span class="ruby-identifier">and_return</span>(<span class="ruby-value">1</span>,<span class="ruby-value">2</span>,<span class="ruby-value">3</span>)
<span class="ruby-identifier">counter</span>.<span class="ruby-identifier">count</span> <span class="ruby-comment"># =&gt; 1</span>
<span class="ruby-identifier">counter</span>.<span class="ruby-identifier">count</span> <span class="ruby-comment"># =&gt; 2</span>
<span class="ruby-identifier">counter</span>.<span class="ruby-identifier">count</span> <span class="ruby-comment"># =&gt; 3</span>
<span class="ruby-identifier">counter</span>.<span class="ruby-identifier">count</span> <span class="ruby-comment"># =&gt; 3</span>
<span class="ruby-identifier">counter</span>.<span class="ruby-identifier">count</span> <span class="ruby-comment"># =&gt; 3</span>
<span class="ruby-comment"># etc</span>
</pre>
          
          

          
          <div class="method-source-code" id="and_return-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rspec-mocks-3.7.0/lib/rspec/mocks/message_expectation.rb, line 69</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">and_return</span>(<span class="ruby-identifier">first_value</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">values</span>)
  <span class="ruby-identifier">raise_already_invoked_error_if_necessary</span>(<span class="ruby-identifier">__method__</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">negative?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;`and_return` is not supported with negative message expectations&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;Implementation blocks aren&#39;t supported with `and_return`&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">values</span>.<span class="ruby-identifier">unshift</span>(<span class="ruby-identifier">first_value</span>)
  <span class="ruby-ivar">@expected_received_count</span> = [<span class="ruby-ivar">@expected_received_count</span>, <span class="ruby-identifier">values</span>.<span class="ruby-identifier">size</span>].<span class="ruby-identifier">max</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">ignoring_args?</span> <span class="ruby-operator">||</span> (<span class="ruby-ivar">@expected_received_count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@at_least</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">terminal_implementation_action</span> = <span class="ruby-constant">AndReturnImplementation</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">values</span>)

  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-and_throw" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">and_throw</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@overload <a
href="MessageExpectation.html#method-i-and_throw">#and_throw</a>(symbol)
@overload <a
href="MessageExpectation.html#method-i-and_throw">#and_throw</a>(symbol,
object)</p>

<p>Tells the object to throw a symbol (with the object if that form is used)
when the message is received.</p>

<p>@return [nil] No further chaining is supported after this. @example</p>

<pre class="ruby"><span class="ruby-identifier">allow</span>(<span class="ruby-identifier">car</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">go</span>).<span class="ruby-identifier">and_throw</span>(:<span class="ruby-identifier">out_of_gas</span>)
<span class="ruby-identifier">allow</span>(<span class="ruby-identifier">car</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">go</span>).<span class="ruby-identifier">and_throw</span>(:<span class="ruby-identifier">out_of_gas</span>, :<span class="ruby-identifier">level</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0.1</span>)
</pre>
          
          

          
          <div class="method-source-code" id="and_throw-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rspec-mocks-3.7.0/lib/rspec/mocks/message_expectation.rb, line 155</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">and_throw</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">raise_already_invoked_error_if_necessary</span>(<span class="ruby-identifier">__method__</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">terminal_implementation_action</span> = <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> { <span class="ruby-identifier">throw</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) }
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-and_wrap_original" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">and_wrap_original</span><span
            class="method-args">(&block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Decorates the stubbed method with the supplied block. The original
unmodified method is passed to the block along with any method call
arguments so you can delegate to it, whilst still being able to change what
args are passed to it and/or change the return value.</p>

<p>@note This is only available on partial doubles.</p>

<p>@return [nil] No further chaining is supported after this. @example</p>

<pre class="ruby"><span class="ruby-identifier">expect</span>(<span class="ruby-identifier">api</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">large_list</span>).<span class="ruby-identifier">and_wrap_original</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">original_method</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">original_method</span>.<span class="ruby-identifier">call</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>).<span class="ruby-identifier">first</span>(<span class="ruby-value">10</span>)
<span class="ruby-keyword">end</span>
</pre>
          
          

          
          <div class="method-source-code" id="and_wrap_original-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rspec-mocks-3.7.0/lib/rspec/mocks/message_expectation.rb, line 115</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">and_wrap_original</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">wrap_original</span>(<span class="ruby-identifier">__method__</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-and_yield" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">and_yield</span><span
            class="method-args">(*args) { |eval_context = object| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Tells the object to yield one or more args to a block when the message is
received.</p>

<p>@return [MessageExpectation] self, to support further chaining. @example</p>

<pre class="ruby"><span class="ruby-identifier">stream</span>.<span class="ruby-identifier">stub</span>(:<span class="ruby-identifier">open</span>).<span class="ruby-identifier">and_yield</span>(<span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>)
</pre>
          
          

          
          <div class="method-source-code" id="and_yield-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rspec-mocks-3.7.0/lib/rspec/mocks/message_expectation.rb, line 167</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">and_yield</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">raise_already_invoked_error_if_necessary</span>(<span class="ruby-identifier">__method__</span>)
  <span class="ruby-keyword">yield</span> <span class="ruby-ivar">@eval_context</span> = <span class="ruby-constant">Object</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>

  <span class="ruby-comment"># Initialize args to yield now that it&#39;s being used, see also: comment</span>
  <span class="ruby-comment"># in constructor.</span>
  <span class="ruby-ivar">@args_to_yield</span> <span class="ruby-operator">||=</span> []

  <span class="ruby-ivar">@args_to_yield</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">args</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">initial_implementation_action</span> = <span class="ruby-constant">AndYieldImplementation</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@args_to_yield</span>, <span class="ruby-ivar">@eval_context</span>, <span class="ruby-ivar">@error_generator</span>)
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-at_least" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">at_least</span><span
            class="method-args">(n, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Constrain a message expectation to be received at least a specific number
of times.</p>

<p>@return [MessageExpectation] self, to support further chaining. @example</p>

<pre class="ruby"><span class="ruby-identifier">expect</span>(<span class="ruby-identifier">dealer</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">deal_card</span>).<span class="ruby-identifier">at_least</span>(<span class="ruby-value">9</span>).<span class="ruby-identifier">times</span>
</pre>
          
          

          
          <div class="method-source-code" id="at_least-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rspec-mocks-3.7.0/lib/rspec/mocks/message_expectation.rb, line 202</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">at_least</span>(<span class="ruby-identifier">n</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">raise_already_invoked_error_if_necessary</span>(<span class="ruby-identifier">__method__</span>)
  <span class="ruby-identifier">set_expected_received_count</span> <span class="ruby-value">:at_least</span>, <span class="ruby-identifier">n</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">n</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;at_least(0) has been removed, use allow(...).to receive(:message) instead&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">inner_implementation_action</span> = <span class="ruby-identifier">block</span>

  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-at_most" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">at_most</span><span
            class="method-args">(n, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Constrain a message expectation to be received at most a specific number of
times.</p>

<p>@return [MessageExpectation] self, to support further chaining. @example</p>

<pre class="ruby"><span class="ruby-identifier">expect</span>(<span class="ruby-identifier">dealer</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">deal_card</span>).<span class="ruby-identifier">at_most</span>(<span class="ruby-value">10</span>).<span class="ruby-identifier">times</span>
</pre>
          
          

          
          <div class="method-source-code" id="at_most-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rspec-mocks-3.7.0/lib/rspec/mocks/message_expectation.rb, line 221</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">at_most</span>(<span class="ruby-identifier">n</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">raise_already_invoked_error_if_necessary</span>(<span class="ruby-identifier">__method__</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">inner_implementation_action</span> = <span class="ruby-identifier">block</span>
  <span class="ruby-identifier">set_expected_received_count</span> <span class="ruby-value">:at_most</span>, <span class="ruby-identifier">n</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-exactly" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">exactly</span><span
            class="method-args">(n, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Constrain a message expectation to be received a specific number of times.</p>

<p>@return [MessageExpectation] self, to support further chaining. @example</p>

<pre class="ruby"><span class="ruby-identifier">expect</span>(<span class="ruby-identifier">dealer</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">deal_card</span>).<span class="ruby-identifier">exactly</span>(<span class="ruby-value">10</span>).<span class="ruby-identifier">times</span>
</pre>
          
          

          
          <div class="method-source-code" id="exactly-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rspec-mocks-3.7.0/lib/rspec/mocks/message_expectation.rb, line 189</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">exactly</span>(<span class="ruby-identifier">n</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">raise_already_invoked_error_if_necessary</span>(<span class="ruby-identifier">__method__</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">inner_implementation_action</span> = <span class="ruby-identifier">block</span>
  <span class="ruby-identifier">set_expected_received_count</span> <span class="ruby-value">:exactly</span>, <span class="ruby-identifier">n</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-inspect" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">inspect</span><span
            class="method-args">()</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="MessageExpectation.html#method-i-to_s">to_s</a>
        </div>
        
      </div>

    
      <div id="method-i-never" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">never</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Expect a message not to be received at all.</p>

<p>@return [MessageExpectation] self, to support further chaining. @example</p>

<pre class="ruby"><span class="ruby-identifier">expect</span>(<span class="ruby-identifier">car</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">stop</span>).<span class="ruby-identifier">never</span>
</pre>
          
          

          
          <div class="method-source-code" id="never-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rspec-mocks-3.7.0/lib/rspec/mocks/message_expectation.rb, line 245</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">never</span>
  <span class="ruby-identifier">error_generator</span>.<span class="ruby-identifier">raise_double_negation_error</span>(<span class="ruby-string">&quot;expect(obj)&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">negative?</span>
  <span class="ruby-ivar">@expected_received_count</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-once" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">once</span><span
            class="method-args">(&block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Expect a message to be received exactly one time.</p>

<p>@return [MessageExpectation] self, to support further chaining. @example</p>

<pre class="ruby"><span class="ruby-identifier">expect</span>(<span class="ruby-identifier">car</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">go</span>).<span class="ruby-identifier">once</span>
</pre>
          
          

          
          <div class="method-source-code" id="once-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rspec-mocks-3.7.0/lib/rspec/mocks/message_expectation.rb, line 256</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">once</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">inner_implementation_action</span> = <span class="ruby-identifier">block</span>
  <span class="ruby-identifier">set_expected_received_count</span> <span class="ruby-value">:exactly</span>, <span class="ruby-value">1</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-ordered" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ordered</span><span
            class="method-args">(&block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Expect messages to be received in a specific order.</p>

<p>@return [MessageExpectation] self, to support further chaining. @example</p>

<pre class="ruby"><span class="ruby-identifier">expect</span>(<span class="ruby-identifier">api</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">prepare</span>).<span class="ruby-identifier">ordered</span>
<span class="ruby-identifier">expect</span>(<span class="ruby-identifier">api</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">run</span>).<span class="ruby-identifier">ordered</span>
<span class="ruby-identifier">expect</span>(<span class="ruby-identifier">api</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">finish</span>).<span class="ruby-identifier">ordered</span>
</pre>
          
          

          
          <div class="method-source-code" id="ordered-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rspec-mocks-3.7.0/lib/rspec/mocks/message_expectation.rb, line 330</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ordered</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:stub</span>
    <span class="ruby-constant">RSpec</span>.<span class="ruby-identifier">warning</span>(
      <span class="ruby-string">&quot;`allow(...).to receive(..).ordered` is not supported and will &quot;</span>              <span class="ruby-string">&quot;have no effect, use `and_return(*ordered_values)` instead.&quot;</span>
    )
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">inner_implementation_action</span> = <span class="ruby-identifier">block</span>
  <span class="ruby-identifier">additional_expected_calls</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword">do</span>
    <span class="ruby-ivar">@order_group</span>.<span class="ruby-identifier">register</span>(<span class="ruby-keyword">self</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@ordered</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-thrice" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">thrice</span><span
            class="method-args">(&block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Expect a message to be received exactly three times.</p>

<p>@return [MessageExpectation] self, to support further chaining. @example</p>

<pre class="ruby"><span class="ruby-identifier">expect</span>(<span class="ruby-identifier">car</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">go</span>).<span class="ruby-identifier">thrice</span>
</pre>
          
          

          
          <div class="method-source-code" id="thrice-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rspec-mocks-3.7.0/lib/rspec/mocks/message_expectation.rb, line 278</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">thrice</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">inner_implementation_action</span> = <span class="ruby-identifier">block</span>
  <span class="ruby-identifier">set_expected_received_count</span> <span class="ruby-value">:exactly</span>, <span class="ruby-value">3</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-times" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">times</span><span
            class="method-args">(&block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Syntactic sugar for `exactly`, `at_least` and `at_most`</p>

<p>@return [MessageExpectation] self, to support further chaining. @example</p>

<pre class="ruby"><span class="ruby-identifier">expect</span>(<span class="ruby-identifier">dealer</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">deal_card</span>).<span class="ruby-identifier">exactly</span>(<span class="ruby-value">10</span>).<span class="ruby-identifier">times</span>
<span class="ruby-identifier">expect</span>(<span class="ruby-identifier">dealer</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">deal_card</span>).<span class="ruby-identifier">at_least</span>(<span class="ruby-value">10</span>).<span class="ruby-identifier">times</span>
<span class="ruby-identifier">expect</span>(<span class="ruby-identifier">dealer</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">deal_card</span>).<span class="ruby-identifier">at_most</span>(<span class="ruby-value">10</span>).<span class="ruby-identifier">times</span>
</pre>
          
          

          
          <div class="method-source-code" id="times-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rspec-mocks-3.7.0/lib/rspec/mocks/message_expectation.rb, line 235</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">times</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">inner_implementation_action</span> = <span class="ruby-identifier">block</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-to_s" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_s</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@return [String] a nice representation of the message expectation</p>
          
          

          
          <div class="method-source-code" id="to_s-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rspec-mocks-3.7.0/lib/rspec/mocks/message_expectation.rb, line 347</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">args_description</span> = <span class="ruby-identifier">error_generator</span>.<span class="ruby-identifier">method_call_args_description</span>(<span class="ruby-ivar">@argument_list_matcher</span>.<span class="ruby-identifier">expected_args</span>, <span class="ruby-string">&quot;&quot;</span>, <span class="ruby-string">&quot;&quot;</span>) { <span class="ruby-keyword">true</span> }
  <span class="ruby-identifier">args_description</span> = <span class="ruby-node">&quot;(#{args_description})&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">args_description</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-string">&quot;(&quot;</span>)
  <span class="ruby-node">&quot;#&lt;#{self.class} #{error_generator.intro}.#{message}#{args_description}&gt;&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="MessageExpectation.html#method-i-inspect">inspect</a>
        </div>
        

        
      </div>

    
      <div id="method-i-twice" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">twice</span><span
            class="method-args">(&block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Expect a message to be received exactly two times.</p>

<p>@return [MessageExpectation] self, to support further chaining. @example</p>

<pre class="ruby"><span class="ruby-identifier">expect</span>(<span class="ruby-identifier">car</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">go</span>).<span class="ruby-identifier">twice</span>
</pre>
          
          

          
          <div class="method-source-code" id="twice-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rspec-mocks-3.7.0/lib/rspec/mocks/message_expectation.rb, line 267</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">twice</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">inner_implementation_action</span> = <span class="ruby-identifier">block</span>
  <span class="ruby-identifier">set_expected_received_count</span> <span class="ruby-value">:exactly</span>, <span class="ruby-value">2</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-with" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with</span><span
            class="method-args">(*args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Constrains a stub or message expectation to invocations with specific
arguments.</p>

<p>With a stub, if the message might be received with other args as well, you
should stub a default value first, and then stub or mock the same message
using `with` to constrain to specific arguments.</p>

<p>A message expectation will fail if the message is received with different
arguments.</p>

<p>@return [MessageExpectation] self, to support further chaining. @example</p>

<pre class="ruby"><span class="ruby-identifier">allow</span>(<span class="ruby-identifier">cart</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">add</span>) { :<span class="ruby-identifier">failure</span> }
<span class="ruby-identifier">allow</span>(<span class="ruby-identifier">cart</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">add</span>).<span class="ruby-identifier">with</span>(<span class="ruby-constant">Book</span>.<span class="ruby-identifier">new</span>(:<span class="ruby-identifier">isbn</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1934356379</span>)) { :<span class="ruby-identifier">success</span> }
<span class="ruby-identifier">cart</span>.<span class="ruby-identifier">add</span>(<span class="ruby-constant">Book</span>.<span class="ruby-identifier">new</span>(:<span class="ruby-identifier">isbn</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1234567890</span>))
<span class="ruby-comment"># =&gt; :failure</span>
<span class="ruby-identifier">cart</span>.<span class="ruby-identifier">add</span>(<span class="ruby-constant">Book</span>.<span class="ruby-identifier">new</span>(:<span class="ruby-identifier">isbn</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1934356379</span>))
<span class="ruby-comment"># =&gt; :success</span>

<span class="ruby-identifier">expect</span>(<span class="ruby-identifier">cart</span>).<span class="ruby-identifier">to</span> <span class="ruby-identifier">receive</span>(:<span class="ruby-identifier">add</span>).<span class="ruby-identifier">with</span>(<span class="ruby-constant">Book</span>.<span class="ruby-identifier">new</span>(:<span class="ruby-identifier">isbn</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1934356379</span>)) { :<span class="ruby-identifier">success</span> }
<span class="ruby-identifier">cart</span>.<span class="ruby-identifier">add</span>(<span class="ruby-constant">Book</span>.<span class="ruby-identifier">new</span>(:<span class="ruby-identifier">isbn</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1234567890</span>))
<span class="ruby-comment"># =&gt; failed expectation</span>
<span class="ruby-identifier">cart</span>.<span class="ruby-identifier">add</span>(<span class="ruby-constant">Book</span>.<span class="ruby-identifier">new</span>(:<span class="ruby-identifier">isbn</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1934356379</span>))
<span class="ruby-comment"># =&gt; passes</span>
</pre>
          
          

          
          <div class="method-source-code" id="with-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rspec-mocks-3.7.0/lib/rspec/mocks/message_expectation.rb, line 311</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">with</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">raise_already_invoked_error_if_necessary</span>(<span class="ruby-identifier">__method__</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>,
          <span class="ruby-string">&quot;`with` must have at least one argument. Use `no_args` matcher to set the expectation of receiving no arguments.&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">inner_implementation_action</span> = <span class="ruby-identifier">block</span>
  <span class="ruby-ivar">@argument_list_matcher</span> = <span class="ruby-constant">ArgumentListMatcher</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://rdoc.github.io/rdoc">RDoc</a> 5.0.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

