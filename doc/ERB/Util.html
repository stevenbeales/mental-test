<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module ERB::Util - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-h">::h</a>
    
    <li ><a href="#method-c-html_escape">::html_escape</a>
    
    <li ><a href="#method-c-html_escape_once">::html_escape_once</a>
    
    <li ><a href="#method-c-json_escape">::json_escape</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-ERB::Util">
  <h1 id="module-ERB::Util" class="module">
    module ERB::Util
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="HTML_ESCAPE">HTML_ESCAPE
        
        <dd>
        
      
        <dt id="HTML_ESCAPE_ONCE_REGEXP">HTML_ESCAPE_ONCE_REGEXP
        
        <dd>
        
      
        <dt id="JSON_ESCAPE">JSON_ESCAPE
        
        <dd>
        
      
        <dt id="JSON_ESCAPE_REGEXP">JSON_ESCAPE_REGEXP
        
        <dd>
        
      
      </dl>
    </section>
    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-h" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">h</span><span
            class="method-args">(s)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="Util.html#method-i-html_escape">html_escape</a>
        </div>
        
      </div>

    
      <div id="method-c-html_escape" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">html_escape</span><span
            class="method-args">(s)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>A utility method for escaping HTML tag characters. This method is also
aliased as <code>h</code>.</p>

<p>In your <a href="../ERB.html">ERB</a> templates, use this method to escape
any unsafe content. For example:</p>

<pre>&lt;%= h @person.name %&gt;

puts html_escape(&#39;is a &gt; 0 &amp; a &lt; 10?&#39;)
# =&gt; is a &amp;gt; 0 &amp;amp; a &amp;lt; 10?</pre>
          
          

          
          <div class="method-source-code" id="html_escape-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activesupport-5.1.5/lib/active_support/core_ext/string/output_safety.rb, line 20</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">html_escape</span>(<span class="ruby-identifier">s</span>)
  <span class="ruby-identifier">unwrapped_html_escape</span>(<span class="ruby-identifier">s</span>).<span class="ruby-identifier">html_safe</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="Util.html#method-i-h">h</a>
        </div>
        

        
      </div>

    
      <div id="method-c-html_escape_once" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">html_escape_once</span><span
            class="method-args">(s)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>A utility method for escaping HTML without affecting existing escaped
entities.</p>

<pre class="ruby"><span class="ruby-identifier">html_escape_once</span>(<span class="ruby-string">&#39;1 &lt; 2 &amp;amp; 3&#39;</span>)
<span class="ruby-comment"># =&gt; &quot;1 &amp;lt; 2 &amp;amp; 3&quot;</span>

<span class="ruby-identifier">html_escape_once</span>(<span class="ruby-string">&#39;&amp;lt;&amp;lt; Accept &amp; Checkout&#39;</span>)
<span class="ruby-comment"># =&gt; &quot;&amp;lt;&amp;lt; Accept &amp;amp; Checkout&quot;</span>
</pre>
          
          

          
          <div class="method-source-code" id="html_escape_once-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activesupport-5.1.5/lib/active_support/core_ext/string/output_safety.rb, line 52</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">html_escape_once</span>(<span class="ruby-identifier">s</span>)
  <span class="ruby-identifier">result</span> = <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Multibyte</span><span class="ruby-operator">::</span><span class="ruby-constant">Unicode</span>.<span class="ruby-identifier">tidy_bytes</span>(<span class="ruby-identifier">s</span>.<span class="ruby-identifier">to_s</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">HTML_ESCAPE_ONCE_REGEXP</span>, <span class="ruby-constant">HTML_ESCAPE</span>)
  <span class="ruby-identifier">s</span>.<span class="ruby-identifier">html_safe?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">html_safe</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-json_escape" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">json_escape</span><span
            class="method-args">(s)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>A utility method for escaping HTML entities in <a
href="../JSON.html">JSON</a> strings. Specifically, the &amp;, &gt; and
&lt; characters are replaced with their equivalent unicode escaped form -
u0026, u003e, and u003c. The <a href="../Unicode.html">Unicode</a>
sequences u2028 and u2029 are also escaped as they are treated as newline
characters in some JavaScript engines. These sequences have identical
meaning as the original characters inside the context of a <a
href="../JSON.html">JSON</a> string, so assuming the input is a valid and
well-formed <a href="../JSON.html">JSON</a> value, the output will have
equivalent meaning when parsed:</p>

<pre class="ruby"><span class="ruby-identifier">json</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">generate</span>({ <span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;&lt;/script&gt;&lt;script&gt;alert(&#39;PWNED!!!&#39;)&lt;/script&gt;&quot;</span>})
<span class="ruby-comment"># =&gt; &quot;{\&quot;name\&quot;:\&quot;&lt;/script&gt;&lt;script&gt;alert(&#39;PWNED!!!&#39;)&lt;/script&gt;\&quot;}&quot;</span>

<span class="ruby-identifier">json_escape</span>(<span class="ruby-identifier">json</span>)
<span class="ruby-comment"># =&gt; &quot;{\&quot;name\&quot;:\&quot;\\u003C/script\\u003E\\u003Cscript\\u003Ealert(&#39;PWNED!!!&#39;)\\u003C/script\\u003E\&quot;}&quot;</span>

<span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">json</span>) <span class="ruby-operator">==</span> <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">json_escape</span>(<span class="ruby-identifier">json</span>))
<span class="ruby-comment"># =&gt; true</span>
</pre>

<p>The intended use case for this method is to escape <a
href="../JSON.html">JSON</a> strings before including them inside a script
tag to avoid XSS vulnerability:</p>

<pre>&lt;script&gt;
  var currentUser = &lt;%= raw json_escape(current_user.to_json) %&gt;;
&lt;/script&gt;</pre>

<p>It is necessary to <code>raw</code> the result of <code>json_escape</code>,
so that quotation marks don&#39;t get converted to <code>&amp;quot;</code>
entities. <code>json_escape</code> doesn&#39;t automatically flag the
result as HTML safe, since the raw value is unsafe to use inside HTML
attributes.</p>

<p>If your <a href="../JSON.html">JSON</a> is being used downstream for
insertion into the DOM, be aware of whether or not it is being inserted via
+html()+. Most jQuery plugins do this. If that is the case, be sure to
<code>html_escape</code> or <code>sanitize</code> any user-generated
content returned by your <a href="../JSON.html">JSON</a>.</p>

<p>If you need to output <a href="../JSON.html">JSON</a> elsewhere in your
HTML, you can just do something like this, as any unsafe characters
(including quotation marks) will be automatically escaped for you:</p>

<pre>&lt;div data-user-info=&quot;&lt;%= current_user.to_json %&gt;&quot;&gt;...&lt;/div&gt;</pre>

<p>WARNING: this helper only works with valid <a href="../JSON.html">JSON</a>.
Using this on non-JSON values will open up serious XSS vulnerabilities. For
example, if you replace the <code>current_user.to_json</code> in the
example above with user input instead, the browser will happily eval() that
string as JavaScript.</p>

<p>The escaping performed in this method is identical to those performed in
the Active Support <a href="../JSON.html">JSON</a> encoder when
<code>ActiveSupport.escape_html_entities_in_json</code> is set to true.
Because this transformation is idempotent, this helper can be applied even
if <code>ActiveSupport.escape_html_entities_in_json</code> is already true.</p>

<p>Therefore, when you are unsure if
<code>ActiveSupport.escape_html_entities_in_json</code> is enabled, or if
you are unsure where your <a href="../JSON.html">JSON</a> string originated
from, it is recommended that you always apply this helper (other libraries,
such as the <a href="../JSON.html">JSON</a> gem, do not provide this kind
of protection by default; also some gems might override
<code>to_json</code> to bypass Active Support&#39;s encoder).</p>
          
          

          
          <div class="method-source-code" id="json_escape-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activesupport-5.1.5/lib/active_support/core_ext/string/output_safety.rb, line 114</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">json_escape</span>(<span class="ruby-identifier">s</span>)
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">s</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">JSON_ESCAPE_REGEXP</span>, <span class="ruby-constant">JSON_ESCAPE</span>)
  <span class="ruby-identifier">s</span>.<span class="ruby-identifier">html_safe?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">html_safe</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://rdoc.github.io/rdoc">RDoc</a> 5.0.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

