<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Logging::Appenders::RollingFile - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="IO.html">Logging::Appenders::IO</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-filename">#filename</a>
    
    <li class="calls-super" ><a href="#method-i-reopen">#reopen</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Logging::Appenders::RollingFile">
  <h1 id="class-Logging::Appenders::RollingFile" class="class">
    class Logging::Appenders::RollingFile
  </h1>

  <section class="description">
    
<p>An appender that writes to a file and ensures that the file size or age
never exceeds some user specified level.</p>

<p>The goal of this class is to write log messages to a file. When the file
age or size exceeds a given limit then the log file is copied and then
truncated. The name of the copy indicates it is an older log file.</p>

<p>The name of the log file is changed by inserting the age of the log file
(as a single number) between the log file name and the extension. If the
file has no extension then the number is appended to the filename. Here is
a simple example:</p>

<pre>/var/log/ruby.log   =&gt;   /var/log/ruby.1.log</pre>

<p>New log messages will continue to be appended to the same log file
(`/var/log/ruby.log` in our example above). The age number for all older
log files is incremented when the log file is rolled. The number of older
log files to keep can be given, otherwise all the log files are kept.</p>

<p>The actual process of rolling all the log file names can be expensive if
there are many, many older log files to process.</p>

<p>If you do not wish to use numbered files when rolling, you can specify the
:roll_by option as &#39;date&#39;. This will use a date/time stamp to
differentiate the older files from one another. If you configure your
rolling file appender to roll daily and ignore the file size:</p>

<pre>/var/log/ruby.log   =&gt;   /var/log/ruby.20091225.log</pre>

<p>Where the date is expressed as `%Y%m%d` in the Time#strftime format.</p>

<p>NOTE: this class is not safe to use when log messages are written to files
on NFS mounts or other remote file system. It should only be used for log
files on the local file system. The exception to this is when a single
process is writing to the log file; remote file systems are safe to use in
this case but still not recommended.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            new( name, opts )
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Creates a new Rolling <a href="File.html">File</a> <a
href="../Appender.html">Appender</a>. The <em>name</em> is the unique <a
href="../Appender.html">Appender</a> name used to retrieve this appender
from the <a href="../Appender.html">Appender</a> hash. The only required
option is the filename to use for creating log files.</p>

<pre>[:filename]  The base filename to use when constructing new log
             filenames.</pre>

<p>The “rolling” portion of the filename can be configured via some simple
pattern templates. For numbered rolling, you can use {{.%d}}</p>

<pre>&quot;logname{{.%d}}.log&quot; =&gt; [&quot;logname.log&quot;, &quot;logname.1.log&quot;, &quot;logname.2.log&quot; ...]
&quot;logname.log{{-%d}}&quot; =&gt; [&quot;logname.log&quot;, &quot;logname.log-1&quot;, &quot;logname.log-2&quot; ...]</pre>

<p>And for date rolling you can use `strftime` patterns:</p>

<pre>&quot;logname{{.%Y%m%d}}.log&quot;            =&gt; [&quot;logname.log, &quot;logname.20130626.log&quot; ...]
&quot;logname{{.%Y-%m-%dT%H:%M:%S}}.log&quot; =&gt; [&quot;logname.log, &quot;logname.2013-06-26T22:03:31.log&quot; ...]</pre>

<p>If the defaults suit you fine, just pass in the :roll_by option and use
your normal log filename without any pattern template.</p>

<p>The following options are optional:</p>

<pre>[:layout]    The Layout that will be used by this appender. The Basic
             layout will be used if none is given.
[:truncate]  When set to true any existing log files will be rolled
             immediately and a new, empty log file will be created.
[:size]      The maximum allowed size (in bytes) of a log file before
             it is rolled.
[:age]       The maximum age (in seconds) of a log file before it is
             rolled. The age can also be given as &#39;daily&#39;, &#39;weekly&#39;,
             or &#39;monthly&#39;.
[:keep]      The number of rolled log files to keep.
[:roll_by]   How to name the rolled log files. This can be &#39;number&#39; or
             &#39;date&#39;.</pre>
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="IO.html#method-c-new">Logging::Appenders::IO.new</a>
            </div>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/logging-2.2.2/lib/logging/appenders/rolling_file.rb, line 86</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>( <span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span> = {} )
  <span class="ruby-ivar">@roller</span> = <span class="ruby-constant">Roller</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>

  <span class="ruby-comment"># grab our options</span>
  <span class="ruby-ivar">@size</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:size</span>, <span class="ruby-keyword">nil</span>)
  <span class="ruby-ivar">@size</span> = <span class="ruby-constant">Integer</span>(<span class="ruby-ivar">@size</span>) <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@size</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-ivar">@age_fn</span> = <span class="ruby-identifier">filename</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;.age&#39;</span>
  <span class="ruby-ivar">@age_fn_mtime</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@age</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:age</span>, <span class="ruby-keyword">nil</span>)

  <span class="ruby-comment"># create our `sufficiently_aged?` method</span>
  <span class="ruby-identifier">build_singleton_methods</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">touch</span>(<span class="ruby-ivar">@age_fn</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@age</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">test</span>(<span class="ruby-value">?f</span>, <span class="ruby-ivar">@age_fn</span>)

  <span class="ruby-comment"># we are opening the file in read/write mode so that a shared lock can</span>
  <span class="ruby-comment"># be used on the file descriptor =&gt; http://pubs.opengroup.org/onlinepubs/009695399/functions/fcntl.html</span>
  <span class="ruby-ivar">@mode</span> = <span class="ruby-identifier">encoding</span> <span class="ruby-operator">?</span> <span class="ruby-node">&quot;a+:#{encoding}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;a+&#39;</span>
  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-ivar">@mode</span>), <span class="ruby-identifier">opts</span>)

  <span class="ruby-comment"># if the truncate flag was set to true, then roll</span>
  <span class="ruby-identifier">roll_now</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:truncate</span>, <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">roll_now</span>
    <span class="ruby-identifier">copy_truncate</span>
    <span class="ruby-ivar">@roller</span>.<span class="ruby-identifier">roll_files</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-filename" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filename</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the path to the logfile.</p>
          
          

          
          <div class="method-source-code" id="filename-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/logging-2.2.2/lib/logging/appenders/rolling_file.rb, line 115</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">filename</span>
  <span class="ruby-ivar">@roller</span>.<span class="ruby-identifier">filename</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reopen" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reopen</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Reopen the connection to the underlying logging destination. If the
connection is currently closed then it will be opened. If the connection is
currently open then it will be closed and immediately opened.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Buffering.html#method-i-reopen">Logging::Appenders::Buffering#reopen</a>
            </div>
          

          
          <div class="method-source-code" id="reopen-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/logging-2.2.2/lib/logging/appenders/rolling_file.rb, line 122</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reopen</span>
  <span class="ruby-ivar">@mutex</span>.<span class="ruby-identifier">synchronize</span> {
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@io</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@io</span>
      <span class="ruby-identifier">flush</span>
      <span class="ruby-ivar">@io</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@io</span> = <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-ivar">@mode</span>)
  }
  <span class="ruby-keyword">super</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://rdoc.github.io/rdoc">RDoc</a> 5.0.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

