<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module Logging::NestedDiagnosticContext - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-3C-3C">#&lt;&lt;</a>
    
    <li ><a href="#method-i-clear">#clear</a>
    
    <li ><a href="#method-i-context">#context</a>
    
    <li ><a href="#method-i-inherit">#inherit</a>
    
    <li ><a href="#method-i-peek">#peek</a>
    
    <li ><a href="#method-i-pop">#pop</a>
    
    <li ><a href="#method-i-push">#push</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-Logging::NestedDiagnosticContext">
  <h1 id="module-Logging::NestedDiagnosticContext" class="module">
    module Logging::NestedDiagnosticContext
  </h1>

  <section class="description">
    
<p>A Nested Diagnostic Context, or NDC in short, is an instrument to
distinguish interleaved log output from different sources. Log output is
typically interleaved when a server handles multiple clients
near-simultaneously.</p>

<p>Interleaved log output can still be meaningful if each log entry from
different contexts had a distinctive stamp. This is where NDCs come into
play.</p>

<p>The NDC is a stack of contextual messages that are pushed and popped by the
client as different contexts are encountered in the application. When a new
context is entered, the client will `push` a new message onto the NDC
stack. This message appears in all log messages. When this context is
exited, the client will call `pop` to remove the message.</p>
<ul><li>
<p>Contexts can be nested</p>
</li><li>
<p>When entering a context, call `Logging.ndc.push`</p>
</li><li>
<p>When leaving a context, call `Logging.ndc.pop`</p>
</li><li>
<p>Configure the PatternLayout to log context information</p>
</li></ul>

<p>There is no penalty for forgetting to match each push operation with a
corresponding pop, except the obvious mismatch between the real application
context and the context set in the NDC.</p>

<p>When configured to do so, PatternLayout instance will automatically
retrieve the nested diagnostic context for the current thread with out any
user intervention. This context information can be used to track user
sessions in a <a href="../Rails.html">Rails</a> application, for example.</p>

<p>Note that NDCs are managed on a per thread basis. NDC operations such as
`push`, `pop`, and `clear` affect the NDC of the current thread only. NDCs
of other threads remain unaffected.</p>

<p>By default, when a new thread is created it will inherit the context of its
parent thread. However, the `inherit` method may be used to inherit context
for any other thread in the application.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="NAME">NAME
        
        <dd><p>The name used to retrieve the NDC from thread-local storage.</p>
        
      
      </dl>
    </section>
    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-3C-3C" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">&lt;&lt;</span><span
            class="method-args">( message )</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="NestedDiagnosticContext.html#method-i-push">push</a>
        </div>
        
      </div>

    
      <div id="method-i-clear" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">clear</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Public: Clear all nested diagnostic information if any. This method is
useful in cases where the same thread can be potentially used over and over
in different unrelated contexts.</p>

<p>Returns the <a
href="NestedDiagnosticContext.html">NestedDiagnosticContext</a>.</p>
          
          

          
          <div class="method-source-code" id="clear-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/logging-2.2.2/lib/logging/diagnostic_context.rb, line 332</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">clear</span>
  <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">thread_variable_set</span>(<span class="ruby-constant">NAME</span>, <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-context" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">context</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the <a href="../Array.html">Array</a> acting as the storage stack
for this <a
href="NestedDiagnosticContext.html">NestedDiagnosticContext</a>. A new
storage <a href="../Array.html">Array</a> is created for each Thread
running in the application.</p>
          
          

          
          <div class="method-source-code" id="context-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/logging-2.2.2/lib/logging/diagnostic_context.rb, line 363</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">context</span>
  <span class="ruby-identifier">c</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">thread_variable_get</span>(<span class="ruby-constant">NAME</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">c</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">thread_variable_set</span>(<span class="ruby-constant">NAME</span>, <span class="ruby-identifier">c</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">c</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-inherit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">inherit</span><span
            class="method-args">( obj )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Public: Inherit the diagnostic context of another thread. In the vast
majority of cases the other thread will the parent that spawned the current
thread. The diagnostic context from the parent thread is cloned before
being inherited; the two diagnostic contexts can be changed independently.</p>

<p>Returns the <a
href="NestedDiagnosticContext.html">NestedDiagnosticContext</a>.</p>
          
          

          
          <div class="method-source-code" id="inherit-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/logging-2.2.2/lib/logging/diagnostic_context.rb, line 345</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">inherit</span>( <span class="ruby-identifier">obj</span> )
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">obj</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
    <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">thread_variable_set</span>(<span class="ruby-constant">NAME</span>, <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">dup</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Thread</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">obj</span>
    <span class="ruby-constant">DIAGNOSTIC_MUTEX</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword">do</span>
      <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">thread_variable_set</span>(<span class="ruby-constant">NAME</span>, <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">thread_variable_get</span>(<span class="ruby-constant">NAME</span>).<span class="ruby-identifier">dup</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">thread_variable_get</span>(<span class="ruby-constant">NAME</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-peek" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">peek</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Public: Looks at the last diagnostic context at the top of this NDC without
removing it. The returned value is the last pushed message. If no context
is available then `nil` is returned.</p>

<p>Returns the last pushed diagnostic message <a
href="../String.html">String</a> or nil if no messages exist.</p>
          
          

          
          <div class="method-source-code" id="peek-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/logging-2.2.2/lib/logging/diagnostic_context.rb, line 322</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">peek</span>
  <span class="ruby-identifier">context</span>.<span class="ruby-identifier">last</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-pop" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">pop</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Public: Clients should call this method before leaving a diagnostic
context. The returned value is the last pushed message. If no context is
available then `nil` is returned.</p>

<p>Returns the last pushed diagnostic message <a
href="../String.html">String</a> or nil if no messages exist.</p>
          
          

          
          <div class="method-source-code" id="pop-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/logging-2.2.2/lib/logging/diagnostic_context.rb, line 311</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">pop</span>
  <span class="ruby-identifier">context</span>.<span class="ruby-identifier">pop</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-push" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">push</span><span
            class="method-args">( message ) { || ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Public: Push new diagnostic context information for the current thread. The
contents of the message parameter is determined solely by the client.</p>

<p>message - The message <a href="../String.html">String</a> to add to the
current context.</p>

<p>Returns the current <a
href="NestedDiagnosticContext.html">NestedDiagnosticContext</a>.</p>
          
          

          
          <div class="method-source-code" id="push-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/logging-2.2.2/lib/logging/diagnostic_context.rb, line 291</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">push</span>( <span class="ruby-identifier">message</span> )
  <span class="ruby-identifier">context</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">message</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-keyword">yield</span>
    <span class="ruby-keyword">ensure</span>
      <span class="ruby-identifier">context</span>.<span class="ruby-identifier">pop</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="NestedDiagnosticContext.html#method-i-3C-3C">&lt;&lt;</a>
        </div>
        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://rdoc.github.io/rdoc">RDoc</a> 5.0.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

