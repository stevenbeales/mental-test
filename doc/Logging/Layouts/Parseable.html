<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Logging::Layouts::Parseable - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../Layout.html">Logging::Layout</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-json">::json</a>
    
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-c-yaml">::yaml</a>
    
    <li ><a href="#method-i-format_cause">#format_cause</a>
    
    <li ><a href="#method-i-format_obj">#format_obj</a>
    
    <li ><a href="#method-i-items-3D">#items=</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Logging::Layouts::Parseable">
  <h1 id="class-Logging::Layouts::Parseable" class="class">
    class Logging::Layouts::Parseable
  </h1>

  <section class="description">
    
<p>This layout will produce parseable log output in either <a
href="../../JSON.html">JSON</a> or <a href="../../YAML.html">YAML</a>
format. This makes it much easier for machines to parse log files and
perform analysis on those logs.</p>

<p>The information about the log event can be configured when the layout is
created. Any or all of the following labels can be set as the
<em>items</em> to log:</p>

<pre>&#39;logger&#39;     Used to output the name of the logger that generated the
             log event.
&#39;timestamp&#39;  Used to output the timestamp of the log event.
&#39;level&#39;      Used to output the level of the log event.
&#39;message&#39;    Used to output the application supplied message
             associated with the log event.
&#39;file&#39;       Used to output the file name where the logging request
             was issued.
&#39;line&#39;       Used to output the line number where the logging request
             was issued.
&#39;method&#39;     Used to output the method name where the logging request
             was issued.
&#39;hostname&#39;   Used to output the hostname
&#39;pid&#39;        Used to output the process ID of the currently running
             program.
&#39;millis&#39;     Used to output the number of milliseconds elapsed from
             the construction of the Layout until creation of the log
             event.
&#39;thread_id&#39;  Used to output the object ID of the thread that generated
             the log event.
&#39;thread&#39;     Used to output the name of the thread that generated the
             log event. Name can be specified using Thread.current[:name]
             notation. Output empty string if name not specified. This
             option helps to create more human readable output for
             multithread application logs.</pre>

<p>These items are supplied to the layout as an array of strings. The items
&#39;file&#39;, &#39;line&#39;, and &#39;method&#39; will only work if the
<a href="../Logger.html">Logger</a> generating the events is configured to
generate tracing information. If this is not the case these fields will
always be empty.</p>

<p>When configured to output log events in <a href="../../YAML.html">YAML</a>
format, each log message will be formatted as a hash in it&#39;s own <a
href="../../YAML.html">YAML</a> document. The hash keys are the name of the
item, and the value is what you would expect it to be. Therefore, for the
default set of times log message would appear as follows:</p>

<pre>---
timestamp: 2009-04-17T16:15:42
level: INFO
logger: Foo::Bar
message: this is a log message
---
timestamp: 2009-04-17T16:15:43
level: ERROR
logger: Foo
message: &lt;RuntimeError&gt; Oooops!!</pre>

<p>The output order of the fields is not guaranteed to be the same as the
order specified in the <em>items</em> list. This is because Ruby hashes are
not ordered by default (unless you&#39;re running this in Ruby 1.9).</p>

<p>When configured to output log events in <a href="../../JSON.html">JSON</a>
format, each log message will be formatted as an object (in the <a
href="../../JSON.html">JSON</a> sense of the word) on it&#39;s own line in
the log output. Therefore, to parse the output you must read it line by
line and parse the individual objects. Taking the same example above the <a
href="../../JSON.html">JSON</a> output would be:</p>

<pre class="ruby">{<span class="ruby-string">&quot;timestamp&quot;</span><span class="ruby-operator">:</span><span class="ruby-string">&quot;2009-04-17T16:15:42&quot;</span>,<span class="ruby-string">&quot;level&quot;</span><span class="ruby-operator">:</span><span class="ruby-string">&quot;INFO&quot;</span>,<span class="ruby-string">&quot;logger&quot;</span><span class="ruby-operator">:</span><span class="ruby-string">&quot;Foo::Bar&quot;</span>,<span class="ruby-string">&quot;message&quot;</span><span class="ruby-operator">:</span><span class="ruby-string">&quot;this is a log message&quot;</span>}
{<span class="ruby-string">&quot;timestamp&quot;</span><span class="ruby-operator">:</span><span class="ruby-string">&quot;2009-04-17T16:15:43&quot;</span>,<span class="ruby-string">&quot;level&quot;</span><span class="ruby-operator">:</span><span class="ruby-string">&quot;ERROR&quot;</span>,<span class="ruby-string">&quot;logger&quot;</span><span class="ruby-operator">:</span><span class="ruby-string">&quot;Foo&quot;</span>,<span class="ruby-string">&quot;message&quot;</span><span class="ruby-operator">:</span><span class="ruby-string">&quot;&lt;RuntimeError&gt; Oooops!!&quot;</span>}
</pre>

<p>The output order of the fields is guaranteed to be the same as the order
specified in the <em>items</em> list.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-items" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">items</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-json" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            json( opts )
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Create a new <a href="Parseable.html">Parseable</a> layout that outputs log
events using <a href="../../JSON.html">JSON</a> style formatting. See the
initializer documentation for available options.</p>
          
          

          
          <div class="method-source-code" id="json-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/logging-2.2.2/lib/logging/layouts/parseable.rb, line 159</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">json</span>( <span class="ruby-identifier">opts</span> = {} )
  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:style</span>] = <span class="ruby-string">&#39;json&#39;</span>
  <span class="ruby-identifier">new</span>(<span class="ruby-identifier">opts</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-new" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            new( opts )
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Creates a new <a href="Parseable.html">Parseable</a> layout using the
following options:</p>

<pre>:style      =&gt; :json or :yaml
:items      =&gt; %w[timestamp level logger message]
:utc_offset =&gt;  &quot;-06:00&quot; or -21600 or &quot;UTC&quot;</pre>
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="../Layout.html#method-c-new">Logging::Layout.new</a>
            </div>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/logging-2.2.2/lib/logging/layouts/parseable.rb, line 184</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>( <span class="ruby-identifier">opts</span> = {} )
  <span class="ruby-keyword">super</span>
  <span class="ruby-ivar">@created_at</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-ivar">@style</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:style</span>, <span class="ruby-string">&#39;json&#39;</span>).<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">intern</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">items</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:items</span>, <span class="ruby-node">%w[timestamp level logger message]</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-yaml" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            yaml( opts )
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Create a new <a href="Parseable.html">Parseable</a> layout that outputs log
events using <a href="../../YAML.html">YAML</a> style formatting. See the
initializer documentation for available options.</p>
          
          

          
          <div class="method-source-code" id="yaml-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/logging-2.2.2/lib/logging/layouts/parseable.rb, line 170</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">yaml</span>( <span class="ruby-identifier">opts</span> = {} )
  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:style</span>] = <span class="ruby-string">&#39;yaml&#39;</span>
  <span class="ruby-identifier">new</span>(<span class="ruby-identifier">opts</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-format_cause" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">format_cause</span><span
            class="method-args">(e)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Internal: Format any nested exceptions found in the given exception `e`
while respecting the maximum `cause_depth`.</p>

<p>e - <a href="../../Exception.html">Exception</a> to format</p>

<p>Returns the cause formatted as a <a href="../../Hash.html">Hash</a></p>
          
          

          
          <div class="method-source-code" id="format_cause-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/logging-2.2.2/lib/logging/layouts/parseable.rb, line 244</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">format_cause</span>(<span class="ruby-identifier">e</span>)
  <span class="ruby-identifier">rv</span> = <span class="ruby-identifier">curr</span> = {}
  <span class="ruby-identifier">prev</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-identifier">cause_depth</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:cause</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">cause</span>

    <span class="ruby-identifier">cause</span> = <span class="ruby-identifier">e</span>.<span class="ruby-identifier">cause</span>
    <span class="ruby-identifier">curr</span>[<span class="ruby-value">:class</span>]     = <span class="ruby-identifier">cause</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span>
    <span class="ruby-identifier">curr</span>[<span class="ruby-value">:message</span>]   = <span class="ruby-identifier">cause</span>.<span class="ruby-identifier">message</span>
    <span class="ruby-identifier">curr</span>[<span class="ruby-value">:backtrace</span>] = <span class="ruby-identifier">format_cause_backtrace</span>(<span class="ruby-identifier">e</span>, <span class="ruby-identifier">cause</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">backtrace?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cause</span>.<span class="ruby-identifier">backtrace</span>

    <span class="ruby-identifier">prev</span>[<span class="ruby-value">:cause</span>] = <span class="ruby-identifier">curr</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">prev</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">prev</span>, <span class="ruby-identifier">curr</span> = <span class="ruby-identifier">curr</span>, {}

    <span class="ruby-identifier">e</span> = <span class="ruby-identifier">cause</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:cause</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">cause</span>
    <span class="ruby-identifier">prev</span>[<span class="ruby-value">:cause</span>] = {<span class="ruby-identifier">message</span><span class="ruby-operator">:</span> <span class="ruby-node">&quot;Further #cause backtraces were omitted&quot;</span>}
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">rv</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-format_obj" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">format_obj</span><span
            class="method-args">( obj )</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Public: Take a given object and convert it into a format suitable for
inclusion as a log message. The conversion allows the object to be more
easily expressed in <a href="../../YAML.html">YAML</a> or <a
href="../../JSON.html">JSON</a> form.</p>

<p>If the object is an <a href="../../Exception.html">Exception</a>, then this
method will return a <a href="../../Hash.html">Hash</a> containing the
exception class name, message, and backtrace (if any).</p>

<p>obj - The <a href="../../Object.html">Object</a> to format</p>

<p>Returns the formatted <a href="../../Object.html">Object</a>.</p>
          
          

          
          <div class="method-source-code" id="format_obj-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/logging-2.2.2/lib/logging/layouts/parseable.rb, line 219</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">format_obj</span>( <span class="ruby-identifier">obj</span> )
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">obj</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Exception</span>
    <span class="ruby-identifier">hash</span> = {
      <span class="ruby-value">:class</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span>,
      <span class="ruby-value">:message</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">message</span>
    }
    <span class="ruby-identifier">hash</span>[<span class="ruby-value">:backtrace</span>] = <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">backtrace</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">backtrace?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">backtrace</span>

    <span class="ruby-identifier">cause</span> = <span class="ruby-identifier">format_cause</span>(<span class="ruby-identifier">obj</span>)
    <span class="ruby-identifier">hash</span>[<span class="ruby-value">:cause</span>] = <span class="ruby-identifier">cause</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">cause</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">hash</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Time</span>
    <span class="ruby-identifier">iso8601_format</span>(<span class="ruby-identifier">obj</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">obj</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-items-3D" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            items = %w[timestamp level logger message]
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Set the log event items that will be formatted by this layout. These items,
and only these items, will appear in the log output.</p>
          
          

          
          <div class="method-source-code" id="items-3D-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/logging-2.2.2/lib/logging/layouts/parseable.rb, line 199</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">items=</span>( <span class="ruby-identifier">ary</span> )
  <span class="ruby-ivar">@items</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">ary</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span>}
  <span class="ruby-identifier">valid</span> = <span class="ruby-constant">DIRECTIVE_TABLE</span>.<span class="ruby-identifier">keys</span>
  <span class="ruby-ivar">@items</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;unknown item - #{name.inspect}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">valid</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">name</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">create_format_method</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://rdoc.github.io/rdoc">RDoc</a> 5.0.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

