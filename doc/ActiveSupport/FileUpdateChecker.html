<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class ActiveSupport::FileUpdateChecker - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../Object.html">Object</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-execute">#execute</a>
    
    <li ><a href="#method-i-execute_if_updated">#execute_if_updated</a>
    
    <li ><a href="#method-i-updated-3F">#updated?</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-ActiveSupport::FileUpdateChecker">
  <h1 id="class-ActiveSupport::FileUpdateChecker" class="class">
    class ActiveSupport::FileUpdateChecker
  </h1>

  <section class="description">
    
<p><a href="FileUpdateChecker.html">FileUpdateChecker</a> specifies the API
used by <a href="../Rails.html">Rails</a> to watch files and control
reloading. The API depends on four methods:</p>
<ul><li>
<p><code>initialize</code> which expects two parameters and one block as
described below.</p>
</li><li>
<p><code>updated?</code> which returns a boolean if there were updates in the
filesystem or not.</p>
</li><li>
<p><code>execute</code> which executes the given block on initialization and
updates the latest watched files and timestamp.</p>
</li><li>
<p><code>execute_if_updated</code> which just executes the block if it was
updated.</p>
</li></ul>

<p>After initialization, a call to <code>execute_if_updated</code> must
execute the block only if there was really a change in the filesystem.</p>

<p>This class is used by <a href="../Rails.html">Rails</a> to reload the <a
href="../I18n.html">I18n</a> framework whenever they are changed upon a new
request.</p>

<pre class="ruby"><span class="ruby-identifier">i18n_reloader</span> = <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">FileUpdateChecker</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">paths</span>) <span class="ruby-keyword">do</span>
  <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">reload!</span>
<span class="ruby-keyword">end</span>

<span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Reloader</span>.<span class="ruby-identifier">to_prepare</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">i18n_reloader</span>.<span class="ruby-identifier">execute_if_updated</span>
<span class="ruby-keyword">end</span>
</pre>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(files, dirs = {}, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>It accepts two parameters on initialization. The first is an array of files
and the second is an optional hash of directories. The hash must have
directories as keys and the value is an array of extensions to be watched
under that directory.</p>

<p>This method must also receive a block that will be called once a path
changes. The array of files and list of directories cannot be changed after
<a href="FileUpdateChecker.html">FileUpdateChecker</a> has been
initialized.</p>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activesupport-5.1.5/lib/active_support/file_update_checker.rb, line 40</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">files</span>, <span class="ruby-identifier">dirs</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">block</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;A block is required to initialize a FileUpdateChecker&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@files</span> = <span class="ruby-identifier">files</span>.<span class="ruby-identifier">freeze</span>
  <span class="ruby-ivar">@glob</span>  = <span class="ruby-identifier">compile_glob</span>(<span class="ruby-identifier">dirs</span>)
  <span class="ruby-ivar">@block</span> = <span class="ruby-identifier">block</span>

  <span class="ruby-ivar">@watched</span>    = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@updated_at</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-ivar">@last_watched</span>   = <span class="ruby-identifier">watched</span>
  <span class="ruby-ivar">@last_update_at</span> = <span class="ruby-identifier">updated_at</span>(<span class="ruby-ivar">@last_watched</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-execute" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">execute</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Executes the given block and updates the latest watched files and
timestamp.</p>
          
          

          
          <div class="method-source-code" id="execute-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activesupport-5.1.5/lib/active_support/file_update_checker.rb, line 78</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">execute</span>
  <span class="ruby-ivar">@last_watched</span>   = <span class="ruby-identifier">watched</span>
  <span class="ruby-ivar">@last_update_at</span> = <span class="ruby-identifier">updated_at</span>(<span class="ruby-ivar">@last_watched</span>)
  <span class="ruby-ivar">@block</span>.<span class="ruby-identifier">call</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-ivar">@watched</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@updated_at</span> = <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-execute_if_updated" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">execute_if_updated</span><span
            class="method-args">() { || ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Execute the block given if updated.</p>
          
          

          
          <div class="method-source-code" id="execute_if_updated-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activesupport-5.1.5/lib/active_support/file_update_checker.rb, line 88</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">execute_if_updated</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">updated?</span>
    <span class="ruby-keyword">yield</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
    <span class="ruby-identifier">execute</span>
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-updated-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">updated?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Check if any of the entries were updated. If so, the watched and/or
updated_at values are cached until the block is executed via
<code>execute</code> or <code>execute_if_updated</code>.</p>
          
          

          
          <div class="method-source-code" id="updated-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activesupport-5.1.5/lib/active_support/file_update_checker.rb, line 59</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">updated?</span>
  <span class="ruby-identifier">current_watched</span> = <span class="ruby-identifier">watched</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@last_watched</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">current_watched</span>.<span class="ruby-identifier">size</span>
    <span class="ruby-ivar">@watched</span> = <span class="ruby-identifier">current_watched</span>
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">current_updated_at</span> = <span class="ruby-identifier">updated_at</span>(<span class="ruby-identifier">current_watched</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@last_update_at</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">current_updated_at</span>
      <span class="ruby-ivar">@watched</span>    = <span class="ruby-identifier">current_watched</span>
      <span class="ruby-ivar">@updated_at</span> = <span class="ruby-identifier">current_updated_at</span>
      <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://rdoc.github.io/rdoc">RDoc</a> 5.0.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

