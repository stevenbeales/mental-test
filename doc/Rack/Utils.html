<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module Rack::Utils - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-add_cookie_to_header">::add_cookie_to_header</a>
    
    <li ><a href="#method-c-add_remove_cookie_to_header">::add_remove_cookie_to_header</a>
    
    <li ><a href="#method-c-best_q_match">::best_q_match</a>
    
    <li ><a href="#method-c-build_nested_query">::build_nested_query</a>
    
    <li ><a href="#method-c-build_query">::build_query</a>
    
    <li ><a href="#method-c-byte_ranges">::byte_ranges</a>
    
    <li ><a href="#method-c-clean_path_info">::clean_path_info</a>
    
    <li ><a href="#method-c-clock_time">::clock_time</a>
    
    <li ><a href="#method-c-delete_cookie_header-21">::delete_cookie_header!</a>
    
    <li ><a href="#method-c-escape">::escape</a>
    
    <li ><a href="#method-c-escape_html">::escape_html</a>
    
    <li ><a href="#method-c-escape_path">::escape_path</a>
    
    <li ><a href="#method-c-get_byte_ranges">::get_byte_ranges</a>
    
    <li ><a href="#method-c-key_space_limit">::key_space_limit</a>
    
    <li ><a href="#method-c-key_space_limit-3D">::key_space_limit=</a>
    
    <li ><a href="#method-c-make_delete_cookie_header">::make_delete_cookie_header</a>
    
    <li ><a href="#method-c-param_depth_limit">::param_depth_limit</a>
    
    <li ><a href="#method-c-param_depth_limit-3D">::param_depth_limit=</a>
    
    <li ><a href="#method-c-parse_cookies">::parse_cookies</a>
    
    <li ><a href="#method-c-parse_cookies_header">::parse_cookies_header</a>
    
    <li ><a href="#method-c-parse_nested_query">::parse_nested_query</a>
    
    <li ><a href="#method-c-parse_query">::parse_query</a>
    
    <li ><a href="#method-c-q_values">::q_values</a>
    
    <li ><a href="#method-c-rfc2109">::rfc2109</a>
    
    <li ><a href="#method-c-rfc2822">::rfc2822</a>
    
    <li ><a href="#method-c-secure_compare">::secure_compare</a>
    
    <li ><a href="#method-c-select_best_encoding">::select_best_encoding</a>
    
    <li ><a href="#method-c-set_cookie_header-21">::set_cookie_header!</a>
    
    <li ><a href="#method-c-status_code">::status_code</a>
    
    <li ><a href="#method-c-unescape">::unescape</a>
    
    <li ><a href="#method-c-unescape_path">::unescape_path</a>
    
    <li ><a href="#method-c-valid_path-3F">::valid_path?</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-Rack::Utils">
  <h1 id="module-Rack::Utils" class="module">
    module Rack::Utils
  </h1>

  <section class="description">
    
<p><a href="Utils.html">Rack::Utils</a> contains a grab-bag of useful methods
for writing web applications adopted from all kinds of Ruby libraries.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="COMMON_SEP">COMMON_SEP
        
        <dd>
        
      
        <dt id="DEFAULT_SEP">DEFAULT_SEP
        
        <dd>
        
      
        <dt id="ESCAPE_HTML">ESCAPE_HTML
        
        <dd>
        
      
        <dt id="ESCAPE_HTML_PATTERN">ESCAPE_HTML_PATTERN
        
        <dd>
        
      
        <dt id="HTTP_STATUS_CODES">HTTP_STATUS_CODES
        
        <dd><p>Every standard HTTP code mapped to the appropriate message. Generated with:
curl -s <a
href="https://www.iana.org/assignments/http-status-codes/http-status-codes-1.csv">www.iana.org/assignments/http-status-codes/http-status-codes-1.csv</a>
| \</p>

<pre>ruby -ne &#39;m = /^(\d{3}),(?!Unassigned|\(Unused\))([^,]+)/.match($_) and \
          puts &quot;#{m[1]} =&gt; \x27#{m[2].strip}\x27,&quot;&#39;</pre>
        
      
        <dt id="InvalidParameterError">InvalidParameterError
        
        <dd>
        
      
        <dt id="KeySpaceConstrainedParams">KeySpaceConstrainedParams
        
        <dd>
        
      
        <dt id="NULL_BYTE">NULL_BYTE
        
        <dd>
        
      
        <dt id="PATH_SEPS">PATH_SEPS
        
        <dd>
        
      
        <dt id="ParameterTypeError">ParameterTypeError
        
        <dd>
        
      
        <dt id="STATUS_WITH_NO_ENTITY_BODY">STATUS_WITH_NO_ENTITY_BODY
        
        <dd><p>Responses with HTTP status codes that should not have an entity body</p>
        
      
        <dt id="SYMBOL_TO_STATUS_CODE">SYMBOL_TO_STATUS_CODE
        
        <dd>
        
      
      </dl>
    </section>
    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-c-default_query_parser" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">default_query_parser</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-c-multipart_part_limit" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">multipart_part_limit</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-add_cookie_to_header" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_cookie_to_header</span><span
            class="method-args">(header, key, value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="add_cookie_to_header-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 217</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_cookie_to_header</span>(<span class="ruby-identifier">header</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">value</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>
    <span class="ruby-identifier">domain</span>  = <span class="ruby-node">&quot;; domain=#{value[:domain]}&quot;</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-value">:domain</span>]
    <span class="ruby-identifier">path</span>    = <span class="ruby-node">&quot;; path=#{value[:path]}&quot;</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-value">:path</span>]
    <span class="ruby-identifier">max_age</span> = <span class="ruby-node">&quot;; max-age=#{value[:max_age]}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-value">:max_age</span>]
    <span class="ruby-comment"># There is an RFC mess in the area of date formatting for Cookies. Not</span>
    <span class="ruby-comment"># only are there contradicting RFCs and examples within RFC text, but</span>
    <span class="ruby-comment"># there are also numerous conflicting names of fields and partially</span>
    <span class="ruby-comment"># cross-applicable specifications.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-comment"># These are best described in RFC 2616 3.3.1. This RFC text also</span>
    <span class="ruby-comment"># specifies that RFC 822 as updated by RFC 1123 is preferred. That is a</span>
    <span class="ruby-comment"># fixed length format with space-date delimited fields.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-comment"># See also RFC 1123 section 5.2.14.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-comment"># RFC 6265 also specifies &quot;sane-cookie-date&quot; as RFC 1123 date, defined</span>
    <span class="ruby-comment"># in RFC 2616 3.3.1. RFC 6265 also gives examples that clearly denote</span>
    <span class="ruby-comment"># the space delimited format. These formats are compliant with RFC 2822.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-comment"># For reference, all involved RFCs are:</span>
    <span class="ruby-comment"># RFC 822</span>
    <span class="ruby-comment"># RFC 1123</span>
    <span class="ruby-comment"># RFC 2109</span>
    <span class="ruby-comment"># RFC 2616</span>
    <span class="ruby-comment"># RFC 2822</span>
    <span class="ruby-comment"># RFC 2965</span>
    <span class="ruby-comment"># RFC 6265</span>
    <span class="ruby-identifier">expires</span> = <span class="ruby-string">&quot;; expires=&quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-identifier">rfc2822</span>(<span class="ruby-identifier">value</span>[<span class="ruby-value">:expires</span>].<span class="ruby-identifier">clone</span>.<span class="ruby-identifier">gmtime</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-value">:expires</span>]
    <span class="ruby-identifier">secure</span> = <span class="ruby-string">&quot;; secure&quot;</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-value">:secure</span>]
    <span class="ruby-identifier">httponly</span> = <span class="ruby-string">&quot;; HttpOnly&quot;</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">value</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-value">:httponly</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">value</span>[<span class="ruby-value">:httponly</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">value</span>[<span class="ruby-value">:http_only</span>])
    <span class="ruby-identifier">same_site</span> =
      <span class="ruby-keyword">case</span> <span class="ruby-identifier">value</span>[<span class="ruby-value">:same_site</span>]
      <span class="ruby-keyword">when</span> <span class="ruby-keyword">false</span>, <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:lax</span>, <span class="ruby-string">&#39;Lax&#39;</span>, <span class="ruby-value">:Lax</span>
        <span class="ruby-string">&#39;; SameSite=Lax&#39;</span>.<span class="ruby-identifier">freeze</span>
      <span class="ruby-keyword">when</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:strict</span>, <span class="ruby-string">&#39;Strict&#39;</span>, <span class="ruby-value">:Strict</span>
        <span class="ruby-string">&#39;; SameSite=Strict&#39;</span>.<span class="ruby-identifier">freeze</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;Invalid SameSite value: #{value[:same_site].inspect}&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">value</span> = <span class="ruby-identifier">value</span>[<span class="ruby-value">:value</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">value</span> = [<span class="ruby-identifier">value</span>] <span class="ruby-keyword">unless</span> <span class="ruby-constant">Array</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">value</span>

  <span class="ruby-identifier">cookie</span> = <span class="ruby-node">&quot;#{escape(key)}=#{value.map { |v| escape v }.join(&#39;&amp;&#39;)}#{domain}&quot;</span>          <span class="ruby-node">&quot;#{path}#{max_age}#{expires}#{secure}#{httponly}#{same_site}&quot;</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">header</span>
  <span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>, <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-identifier">cookie</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>
    [<span class="ruby-identifier">header</span>, <span class="ruby-identifier">cookie</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
    (<span class="ruby-identifier">header</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">cookie</span>]).<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;Unrecognized cookie header value. Expected String, Array, or nil, got #{header.inspect}&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-add_remove_cookie_to_header" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_remove_cookie_to_header</span><span
            class="method-args">(header, key, value = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Adds a cookie that will <strong>remove</strong> a cookie from the client. 
Hence the strange method name.</p>
          
          

          
          <div class="method-source-code" id="add_remove_cookie_to_header-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 319</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_remove_cookie_to_header</span>(<span class="ruby-identifier">header</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span> = {})
  <span class="ruby-identifier">new_header</span> = <span class="ruby-identifier">make_delete_cookie_header</span>(<span class="ruby-identifier">header</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)

  <span class="ruby-identifier">add_cookie_to_header</span>(<span class="ruby-identifier">new_header</span>, <span class="ruby-identifier">key</span>,
             {<span class="ruby-value">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;&#39;</span>, <span class="ruby-value">:path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">:domain</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,
               <span class="ruby-value">:max_age</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;0&#39;</span>,
               <span class="ruby-value">:expires</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-value">0</span>) }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">value</span>))

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-best_q_match" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">best_q_match</span><span
            class="method-args">(q_value_header, available_mimes)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="best_q_match-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 142</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">best_q_match</span>(<span class="ruby-identifier">q_value_header</span>, <span class="ruby-identifier">available_mimes</span>)
  <span class="ruby-identifier">values</span> = <span class="ruby-identifier">q_values</span>(<span class="ruby-identifier">q_value_header</span>)

  <span class="ruby-identifier">matches</span> = <span class="ruby-identifier">values</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req_mime</span>, <span class="ruby-identifier">quality</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">match</span> = <span class="ruby-identifier">available_mimes</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">am</span><span class="ruby-operator">|</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Mime</span>.<span class="ruby-identifier">match?</span>(<span class="ruby-identifier">am</span>, <span class="ruby-identifier">req_mime</span>) }
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">match</span>
    [<span class="ruby-identifier">match</span>, <span class="ruby-identifier">quality</span>]
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">sort_by</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">match</span>, <span class="ruby-identifier">quality</span><span class="ruby-operator">|</span>
    (<span class="ruby-identifier">match</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;/&#39;</span>, <span class="ruby-value">2</span>).<span class="ruby-identifier">count</span>(<span class="ruby-string">&#39;*&#39;</span>) <span class="ruby-operator">*</span> <span class="ruby-value">-10</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">quality</span>
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">last</span>
  <span class="ruby-identifier">matches</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">matches</span>.<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-build_nested_query" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_nested_query</span><span
            class="method-args">(value, prefix = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="build_nested_query-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 111</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_nested_query</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">prefix</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">value</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
    <span class="ruby-identifier">value</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">build_nested_query</span>(<span class="ruby-identifier">v</span>, <span class="ruby-node">&quot;#{prefix}[]&quot;</span>)
    }.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;&amp;&quot;</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>
    <span class="ruby-identifier">value</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">build_nested_query</span>(<span class="ruby-identifier">v</span>, <span class="ruby-identifier">prefix</span> <span class="ruby-operator">?</span> <span class="ruby-node">&quot;#{prefix}[#{escape(k)}]&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">escape</span>(<span class="ruby-identifier">k</span>))
    }.<span class="ruby-identifier">reject</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:empty?</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;&amp;&#39;</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">prefix</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;value must be a Hash&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">prefix</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-node">&quot;#{prefix}=#{escape(value)}&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-build_query" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_query</span><span
            class="method-args">(params)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="build_query-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 100</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_query</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-identifier">params</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Array</span>
      <span class="ruby-identifier">build_query</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">k</span>, <span class="ruby-identifier">x</span>] })
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">v</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">escape</span>(<span class="ruby-identifier">k</span>) <span class="ruby-operator">:</span> <span class="ruby-node">&quot;#{escape(k)}=#{escape(v)}&quot;</span>
    <span class="ruby-keyword">end</span>
  }.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;&amp;&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-byte_ranges" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">byte_ranges</span><span
            class="method-args">(env, size)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parses the “Range:” header, if present, into an array of <a
href="../Range.html">Range</a> objects. Returns nil if the header is
missing or syntactically invalid. Returns an empty array if none of the
ranges are satisfiable.</p>
          
          

          
          <div class="method-source-code" id="byte_ranges-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 354</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">byte_ranges</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">size</span>)
  <span class="ruby-identifier">warn</span> <span class="ruby-string">&quot;`byte_ranges` is deprecated, please use `get_byte_ranges`&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">$VERBOSE</span>
  <span class="ruby-identifier">get_byte_ranges</span> <span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;HTTP_RANGE&#39;</span>], <span class="ruby-identifier">size</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-clean_path_info" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">clean_path_info</span><span
            class="method-args">(path_info)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="clean_path_info-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 595</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">clean_path_info</span>(<span class="ruby-identifier">path_info</span>)
  <span class="ruby-identifier">parts</span> = <span class="ruby-identifier">path_info</span>.<span class="ruby-identifier">split</span> <span class="ruby-constant">PATH_SEPS</span>

  <span class="ruby-identifier">clean</span> = []

  <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">part</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">part</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">part</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;.&#39;</span>
    <span class="ruby-identifier">part</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;..&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">clean</span>.<span class="ruby-identifier">pop</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">clean</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">part</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">clean</span>.<span class="ruby-identifier">unshift</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">clean</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-clock_time" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">clock_time</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="clock_time-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 80</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">clock_time</span>
  <span class="ruby-constant">Process</span>.<span class="ruby-identifier">clock_gettime</span>(<span class="ruby-constant">Process</span><span class="ruby-operator">::</span><span class="ruby-constant">CLOCK_MONOTONIC</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-delete_cookie_header-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_cookie_header!</span><span
            class="method-args">(header, key, value = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="delete_cookie_header-21-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 311</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_cookie_header!</span>(<span class="ruby-identifier">header</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span> = {})
  <span class="ruby-identifier">header</span>[<span class="ruby-constant">SET_COOKIE</span>] = <span class="ruby-identifier">add_remove_cookie_to_header</span>(<span class="ruby-identifier">header</span>[<span class="ruby-constant">SET_COOKIE</span>], <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-escape" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">escape</span><span
            class="method-args">(s)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>URI escapes. (CGI style space to +)</p>
          
          

          
          <div class="method-source-code" id="escape-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 27</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">escape</span>(<span class="ruby-identifier">s</span>)
  <span class="ruby-constant">URI</span>.<span class="ruby-identifier">encode_www_form_component</span>(<span class="ruby-identifier">s</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-escape_html" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">escape_html</span><span
            class="method-args">(string)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Escape ampersands, brackets and quotes to their HTML/XML entities.</p>
          
          

          
          <div class="method-source-code" id="escape_html-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 168</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">escape_html</span>(<span class="ruby-identifier">string</span>)
  <span class="ruby-identifier">string</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">ESCAPE_HTML_PATTERN</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-constant">ESCAPE_HTML</span>[<span class="ruby-identifier">c</span>] }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-escape_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">escape_path</span><span
            class="method-args">(s)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Like URI escaping, but with %20 instead of +. Strictly speaking this is
true URI escaping.</p>
          
          

          
          <div class="method-source-code" id="escape_path-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 34</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">escape_path</span>(<span class="ruby-identifier">s</span>)
  <span class="ruby-operator">::</span><span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-constant">DEFAULT_PARSER</span>.<span class="ruby-identifier">escape</span> <span class="ruby-identifier">s</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-get_byte_ranges" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_byte_ranges</span><span
            class="method-args">(http_range, size)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_byte_ranges-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 360</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_byte_ranges</span>(<span class="ruby-identifier">http_range</span>, <span class="ruby-identifier">size</span>)
  <span class="ruby-comment"># See &lt;http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.35&gt;</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">http_range</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">http_range</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/bytes=([^;]+)/</span>
  <span class="ruby-identifier">ranges</span> = []
  <span class="ruby-node">$1</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/,\s*/</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">range_spec</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">range_spec</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/(\d*)-(\d*)/</span>
    <span class="ruby-identifier">r0</span>,<span class="ruby-identifier">r1</span> = <span class="ruby-node">$1</span>, <span class="ruby-node">$2</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">r0</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">r1</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-comment"># suffix-byte-range-spec, represents trailing suffix of file</span>
      <span class="ruby-identifier">r0</span> = <span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">r1</span>.<span class="ruby-identifier">to_i</span>
      <span class="ruby-identifier">r0</span> = <span class="ruby-value">0</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">r0</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>
      <span class="ruby-identifier">r1</span> = <span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">r0</span> = <span class="ruby-identifier">r0</span>.<span class="ruby-identifier">to_i</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">r1</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-identifier">r1</span> = <span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">r1</span> = <span class="ruby-identifier">r1</span>.<span class="ruby-identifier">to_i</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">r1</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">r0</span>  <span class="ruby-comment"># backwards range is syntactically invalid</span>
        <span class="ruby-identifier">r1</span> = <span class="ruby-identifier">size</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>  <span class="ruby-keyword">if</span> <span class="ruby-identifier">r1</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">size</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">ranges</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">r0</span><span class="ruby-operator">..</span><span class="ruby-identifier">r1</span>)  <span class="ruby-keyword">if</span> <span class="ruby-identifier">r0</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">r1</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">ranges</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-key_space_limit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">key_space_limit</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="key_space_limit-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 71</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">key_space_limit</span>
  <span class="ruby-identifier">default_query_parser</span>.<span class="ruby-identifier">key_space_limit</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-key_space_limit-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">key_space_limit=</span><span
            class="method-args">(v)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="key_space_limit-3D-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 75</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">key_space_limit=</span>(<span class="ruby-identifier">v</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">default_query_parser</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">default_query_parser</span>.<span class="ruby-identifier">new_space_limit</span>(<span class="ruby-identifier">v</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-make_delete_cookie_header" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">make_delete_cookie_header</span><span
            class="method-args">(header, key, value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="make_delete_cookie_header-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 287</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">make_delete_cookie_header</span>(<span class="ruby-identifier">header</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">header</span>
  <span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>, <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-identifier">cookies</span> = []
  <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>
    <span class="ruby-identifier">cookies</span> = <span class="ruby-identifier">header</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\n&quot;</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
    <span class="ruby-identifier">cookies</span> = <span class="ruby-identifier">header</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">reject!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">cookie</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>[<span class="ruby-value">:domain</span>]
      <span class="ruby-identifier">cookie</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/\A#{escape(key)}=.*domain=#{value[:domain]}/</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">value</span>[<span class="ruby-value">:path</span>]
      <span class="ruby-identifier">cookie</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/\A#{escape(key)}=.*path=#{value[:path]}/</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">cookie</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/\A#{escape(key)}=/</span>
    <span class="ruby-keyword">end</span>
  }

  <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-param_depth_limit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">param_depth_limit</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="param_depth_limit-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 63</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">param_depth_limit</span>
  <span class="ruby-identifier">default_query_parser</span>.<span class="ruby-identifier">param_depth_limit</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-param_depth_limit-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">param_depth_limit=</span><span
            class="method-args">(v)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="param_depth_limit-3D-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 67</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">param_depth_limit=</span>(<span class="ruby-identifier">v</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">default_query_parser</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">default_query_parser</span>.<span class="ruby-identifier">new_depth_limit</span>(<span class="ruby-identifier">v</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-parse_cookies" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_cookies</span><span
            class="method-args">(env)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="parse_cookies-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 201</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_cookies</span>(<span class="ruby-identifier">env</span>)
  <span class="ruby-identifier">parse_cookies_header</span> <span class="ruby-identifier">env</span>[<span class="ruby-constant">HTTP_COOKIE</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-parse_cookies_header" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_cookies_header</span><span
            class="method-args">(header)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="parse_cookies_header-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 206</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_cookies_header</span>(<span class="ruby-identifier">header</span>)
  <span class="ruby-comment"># According to RFC 2109:</span>
  <span class="ruby-comment">#   If multiple cookies satisfy the criteria above, they are ordered in</span>
  <span class="ruby-comment">#   the Cookie header such that those with more specific Path attributes</span>
  <span class="ruby-comment">#   precede those with less specific.  Ordering with respect to other</span>
  <span class="ruby-comment">#   attributes (e.g., Domain) is unspecified.</span>
  <span class="ruby-identifier">cookies</span> = <span class="ruby-identifier">parse_query</span>(<span class="ruby-identifier">header</span>, <span class="ruby-string">&#39;;,&#39;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">unescape</span>(<span class="ruby-identifier">s</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">s</span> }
  <span class="ruby-identifier">cookies</span>.<span class="ruby-identifier">each_with_object</span>({}) { <span class="ruby-operator">|</span>(<span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span>), <span class="ruby-identifier">hash</span><span class="ruby-operator">|</span> <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-constant">Array</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">v</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-parse_nested_query" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_nested_query</span><span
            class="method-args">(qs, d = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="parse_nested_query-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 95</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_nested_query</span>(<span class="ruby-identifier">qs</span>, <span class="ruby-identifier">d</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Utils</span>.<span class="ruby-identifier">default_query_parser</span>.<span class="ruby-identifier">parse_nested_query</span>(<span class="ruby-identifier">qs</span>, <span class="ruby-identifier">d</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-parse_query" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_query</span><span
            class="method-args">(qs, d = nil, &unescaper)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="parse_query-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 90</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_query</span>(<span class="ruby-identifier">qs</span>, <span class="ruby-identifier">d</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">unescaper</span>)
  <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Utils</span>.<span class="ruby-identifier">default_query_parser</span>.<span class="ruby-identifier">parse_query</span>(<span class="ruby-identifier">qs</span>, <span class="ruby-identifier">d</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">unescaper</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-q_values" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">q_values</span><span
            class="method-args">(q_value_header)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="q_values-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 130</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">q_values</span>(<span class="ruby-identifier">q_value_header</span>)
  <span class="ruby-identifier">q_value_header</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\s*,\s*/</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">part</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">value</span>, <span class="ruby-identifier">parameters</span> = <span class="ruby-identifier">part</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\s*;\s*/</span>, <span class="ruby-value">2</span>)
    <span class="ruby-identifier">quality</span> = <span class="ruby-value">1.0</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">md</span> = <span class="ruby-regexp">/\Aq=([\d.]+)/</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">parameters</span>)
      <span class="ruby-identifier">quality</span> = <span class="ruby-identifier">md</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_f</span>
    <span class="ruby-keyword">end</span>
    [<span class="ruby-identifier">value</span>, <span class="ruby-identifier">quality</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-rfc2109" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rfc2109</span><span
            class="method-args">(time)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Modified version of stdlib time.rb Time#rfc2822 to use &#39;%d-%b-%Y&#39;
instead of &#39;% %b %Y&#39;. It assumes that the time is in GMT to comply
to the RFC 2109.</p>

<p>NOTE: I&#39;m not sure the RFC says it requires GMT, but is ambiguous
enough that I&#39;m certain someone implemented only that option. Do not
use %a and %b from Time.strptime, it would use localized names for weekday
and month.</p>
          
          

          
          <div class="method-source-code" id="rfc2109-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 344</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">rfc2109</span>(<span class="ruby-identifier">time</span>)
  <span class="ruby-identifier">wday</span> = <span class="ruby-constant">Time</span><span class="ruby-operator">::</span><span class="ruby-constant">RFC2822_DAY_NAME</span>[<span class="ruby-identifier">time</span>.<span class="ruby-identifier">wday</span>]
  <span class="ruby-identifier">mon</span> = <span class="ruby-constant">Time</span><span class="ruby-operator">::</span><span class="ruby-constant">RFC2822_MONTH_NAME</span>[<span class="ruby-identifier">time</span>.<span class="ruby-identifier">mon</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>]
  <span class="ruby-identifier">time</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-node">&quot;#{wday}, %d-#{mon}-%Y %H:%M:%S GMT&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-rfc2822" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rfc2822</span><span
            class="method-args">(time)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="rfc2822-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 330</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">rfc2822</span>(<span class="ruby-identifier">time</span>)
  <span class="ruby-identifier">time</span>.<span class="ruby-identifier">rfc2822</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-secure_compare" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">secure_compare</span><span
            class="method-args">(a, b)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Constant time string comparison.</p>

<p>NOTE: the values compared should be of fixed length, such as strings that
have already been processed by HMAC. This should not be used on variable
length plaintext strings because it could leak length info via timing
attacks.</p>
          
          

          
          <div class="method-source-code" id="secure_compare-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 395</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">secure_compare</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">bytesize</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">bytesize</span>

  <span class="ruby-identifier">l</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-string">&quot;C*&quot;</span>)

  <span class="ruby-identifier">r</span>, <span class="ruby-identifier">i</span> = <span class="ruby-value">0</span>, <span class="ruby-value">-1</span>
  <span class="ruby-identifier">b</span>.<span class="ruby-identifier">each_byte</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span> <span class="ruby-operator">|=</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">^</span> <span class="ruby-identifier">l</span>[<span class="ruby-identifier">i</span><span class="ruby-operator">+=</span><span class="ruby-value">1</span>] }
  <span class="ruby-identifier">r</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-select_best_encoding" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">select_best_encoding</span><span
            class="method-args">(available_encodings, accept_encoding)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="select_best_encoding-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 173</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">select_best_encoding</span>(<span class="ruby-identifier">available_encodings</span>, <span class="ruby-identifier">accept_encoding</span>)
  <span class="ruby-comment"># http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html</span>

  <span class="ruby-identifier">expanded_accept_encoding</span> =
    <span class="ruby-identifier">accept_encoding</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span>, <span class="ruby-identifier">q</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">m</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;*&quot;</span>
        (<span class="ruby-identifier">available_encodings</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">accept_encoding</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m2</span>, <span class="ruby-identifier">_</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m2</span> }).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m2</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">m2</span>, <span class="ruby-identifier">q</span>] }
      <span class="ruby-keyword">else</span>
        [[<span class="ruby-identifier">m</span>, <span class="ruby-identifier">q</span>]]
      <span class="ruby-keyword">end</span>
    }.<span class="ruby-identifier">inject</span>([]) { <span class="ruby-operator">|</span><span class="ruby-identifier">mem</span>, <span class="ruby-identifier">list</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">mem</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">list</span>
    }

  <span class="ruby-identifier">encoding_candidates</span> = <span class="ruby-identifier">expanded_accept_encoding</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">q</span><span class="ruby-operator">|</span> <span class="ruby-operator">-</span><span class="ruby-identifier">q</span> }.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span>, <span class="ruby-identifier">_</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span> }

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">encoding_candidates</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;identity&quot;</span>)
    <span class="ruby-identifier">encoding_candidates</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">&quot;identity&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">expanded_accept_encoding</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">m</span>, <span class="ruby-identifier">q</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">encoding_candidates</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">m</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">q</span> <span class="ruby-operator">==</span> <span class="ruby-value">0.0</span>
  }

  <span class="ruby-keyword">return</span> (<span class="ruby-identifier">encoding_candidates</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">available_encodings</span>)[<span class="ruby-value">0</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-set_cookie_header-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_cookie_header!</span><span
            class="method-args">(header, key, value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="set_cookie_header-21-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 281</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_cookie_header!</span>(<span class="ruby-identifier">header</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-identifier">header</span>[<span class="ruby-constant">SET_COOKIE</span>] = <span class="ruby-identifier">add_cookie_to_header</span>(<span class="ruby-identifier">header</span>[<span class="ruby-constant">SET_COOKIE</span>], <span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-status_code" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">status_code</span><span
            class="method-args">(status)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="status_code-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 584</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">status_code</span>(<span class="ruby-identifier">status</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">status</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>)
    <span class="ruby-constant">SYMBOL_TO_STATUS_CODE</span>[<span class="ruby-identifier">status</span>] <span class="ruby-operator">||</span> <span class="ruby-value">500</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">status</span>.<span class="ruby-identifier">to_i</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-unescape" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unescape</span><span
            class="method-args">(s, encoding = Encoding::UTF_8)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Unescapes a URI escaped string with <code>encoding</code>.
<code>encoding</code> will be the target encoding of the string returned,
and it defaults to UTF-8</p>
          
          

          
          <div class="method-source-code" id="unescape-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 49</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">unescape</span>(<span class="ruby-identifier">s</span>, <span class="ruby-identifier">encoding</span> = <span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">UTF_8</span>)
  <span class="ruby-constant">URI</span>.<span class="ruby-identifier">decode_www_form_component</span>(<span class="ruby-identifier">s</span>, <span class="ruby-identifier">encoding</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-unescape_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unescape_path</span><span
            class="method-args">(s)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Unescapes the *<strong>path</strong>* component of a URI.  See <a
href="Utils.html#method-c-unescape">::unescape</a> for unescaping query
parameters or form components.</p>
          
          

          
          <div class="method-source-code" id="unescape_path-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 41</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">unescape_path</span>(<span class="ruby-identifier">s</span>)
  <span class="ruby-operator">::</span><span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-constant">DEFAULT_PARSER</span>.<span class="ruby-identifier">unescape</span> <span class="ruby-identifier">s</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-valid_path-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">valid_path?</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="valid_path-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/rack-2.0.4/lib/rack/utils.rb, line 613</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">valid_path?</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-identifier">path</span>.<span class="ruby-identifier">valid_encoding?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">path</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-constant">NULL_BYTE</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://rdoc.github.io/rdoc">RDoc</a> 5.0.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

