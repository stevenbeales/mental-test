<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class ActiveRecord::FixtureSet - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#class-ActiveRecord::FixtureSet-label-Using+Fixtures+in+Test+Cases">Using Fixtures in Test Cases</a>
    <li><a href="#class-ActiveRecord::FixtureSet-label-Dynamic+fixtures+with+ERB">Dynamic fixtures with ERB</a>
    <li><a href="#class-ActiveRecord::FixtureSet-label-Transactional+Tests">Transactional Tests</a>
    <li><a href="#class-ActiveRecord::FixtureSet-label-Advanced+Fixtures">Advanced Fixtures</a>
    <li><a href="#class-ActiveRecord::FixtureSet-label-Stable-2C+Autogenerated+IDs">Stable, Autogenerated IDs</a>
    <li><a href="#class-ActiveRecord::FixtureSet-label-Label+references+for+associations+-28belongs_to-2C+has_one-2C+has_many-29">Label references for associations (belongs_to, has_one, has_many)</a>
    <li><a href="#class-ActiveRecord::FixtureSet-label-belongs_to">belongs_to</a>
    <li><a href="#class-ActiveRecord::FixtureSet-label-Polymorphic+belongs_to">Polymorphic belongs_to</a>
    <li><a href="#class-ActiveRecord::FixtureSet-label-has_and_belongs_to_many">has_and_belongs_to_many</a>
    <li><a href="#class-ActiveRecord::FixtureSet-label-Autofilled+Timestamp+Columns">Autofilled Timestamp Columns</a>
    <li><a href="#class-ActiveRecord::FixtureSet-label-Fixture+label+interpolation">Fixture label interpolation</a>
    <li><a href="#class-ActiveRecord::FixtureSet-label-Support+for+YAML+defaults">Support for YAML defaults</a>
    <li><a href="#class-ActiveRecord::FixtureSet-label-Configure+the+fixture+model+class">Configure the fixture model class</a>
  </ul>
</div>


  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../Object.html">Object</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-cache_fixtures">::cache_fixtures</a>
    
    <li ><a href="#method-c-cache_for_connection">::cache_for_connection</a>
    
    <li ><a href="#method-c-cached_fixtures">::cached_fixtures</a>
    
    <li ><a href="#method-c-context_class">::context_class</a>
    
    <li ><a href="#method-c-create_fixtures">::create_fixtures</a>
    
    <li ><a href="#method-c-fixture_is_cached-3F">::fixture_is_cached?</a>
    
    <li ><a href="#method-c-identify">::identify</a>
    
    <li ><a href="#method-c-instantiate_all_loaded_fixtures">::instantiate_all_loaded_fixtures</a>
    
    <li ><a href="#method-c-instantiate_fixtures">::instantiate_fixtures</a>
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-c-reset_cache">::reset_cache</a>
    
    <li ><a href="#method-i-5B-5D">#[]</a>
    
    <li ><a href="#method-i-5B-5D-3D">#[]=</a>
    
    <li ><a href="#method-i-each">#each</a>
    
    <li ><a href="#method-i-size">#size</a>
    
    <li ><a href="#method-i-table_rows">#table_rows</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-ActiveRecord::FixtureSet">
  <h1 id="class-ActiveRecord::FixtureSet" class="class">
    class ActiveRecord::FixtureSet
  </h1>

  <section class="description">
    
<p>Fixtures are a way of organizing data that you want to test against; in
short, sample data.</p>

<p>They are stored in <a href="../YAML.html">YAML</a> files, one file per
model, which are placed in the directory appointed by
<code>ActiveSupport::TestCase.fixture_path=(path)</code> (this is
automatically configured for <a href="../Rails.html">Rails</a>, so you can
just put your files in <code>&lt;your-rails-app&gt;/test/fixtures/</code>).
The fixture file ends with the <code>.yml</code> file extension, for
example: <code>&lt;your-rails-app&gt;/test/fixtures/web_sites.yml</code>).</p>

<p>The format of a fixture file looks like this:</p>

<pre>rubyonrails:
  id: 1
  name: Ruby on Rails
  url: http://www.rubyonrails.org

google:
  id: 2
  name: Google
  url: http://www.google.com</pre>

<p>This fixture file includes two fixtures. Each <a
href="../YAML.html">YAML</a> fixture (ie. record) is given a name and is
followed by an indented list of key/value pairs in the “key: value” format.
Records are separated by a blank line for your viewing pleasure.</p>

<p>Note: Fixtures are unordered. If you want ordered fixtures, use the omap <a
href="../YAML.html">YAML</a> type. See <a
href="http://yaml.org/type/omap.html">yaml.org/type/omap.html</a> for the
specification. You will need ordered fixtures when you have foreign key
constraints on keys in the same table. This is commonly needed for tree
structures. Example:</p>

<pre>--- !omap
- parent:
    id:         1
    parent_id:  NULL
    title:      Parent
- child:
    id:         2
    parent_id:  1
    title:      Child</pre>

<h1 id="class-ActiveRecord::FixtureSet-label-Using+Fixtures+in+Test+Cases">Using Fixtures in <a href="../Test.html">Test</a> Cases<span><a href="#class-ActiveRecord::FixtureSet-label-Using+Fixtures+in+Test+Cases">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>Since fixtures are a testing construct, we use them in our unit and
functional tests. There are two ways to use the fixtures, but first
let&#39;s take a look at a sample unit test:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;test_helper&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">WebSiteTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">TestCase</span>
  <span class="ruby-identifier">test</span> <span class="ruby-string">&quot;web_site_count&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-constant">WebSite</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>By default, <code>test_helper.rb</code> will load all of your fixtures into
your test database, so this test will succeed.</p>

<p>The testing environment will automatically load all the fixtures into the
database before each test. To ensure consistent data, the environment
deletes the fixtures before running the load.</p>

<p>In addition to being available in the database, the fixture&#39;s data may
also be accessed by using a special dynamic method, which has the same name
as the model, and accepts the name of the fixture to instantiate:</p>

<pre class="ruby"><span class="ruby-identifier">test</span> <span class="ruby-string">&quot;find&quot;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;Ruby on Rails&quot;</span>, <span class="ruby-identifier">web_sites</span>(:<span class="ruby-identifier">rubyonrails</span>).<span class="ruby-identifier">name</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Alternatively, you may enable auto-instantiation of the fixture data. For
instance, take the following tests:</p>

<pre class="ruby"><span class="ruby-identifier">test</span> <span class="ruby-string">&quot;find_alt_method_1&quot;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;Ruby on Rails&quot;</span>, <span class="ruby-ivar">@web_sites</span>[<span class="ruby-string">&#39;rubyonrails&#39;</span>][<span class="ruby-string">&#39;name&#39;</span>]
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">test</span> <span class="ruby-string">&quot;find_alt_method_2&quot;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;Ruby on Rails&quot;</span>, <span class="ruby-ivar">@rubyonrails</span>.<span class="ruby-identifier">name</span>
<span class="ruby-keyword">end</span>
</pre>

<p>In order to use these methods to access fixtured data within your test
cases, you must specify one of the following in your
ActiveSupport::TestCase-derived class:</p>
<ul><li>
<p>to fully enable instantiated fixtures (enable alternate methods #1 and #2
above)</p>

<pre class="ruby"><span class="ruby-keyword">self</span>.<span class="ruby-identifier">use_instantiated_fixtures</span> = <span class="ruby-keyword">true</span>
</pre>
</li><li>
<p>create only the hash for the fixtures, do not &#39;find&#39; each instance
(enable alternate method #1 only)</p>

<pre class="ruby"><span class="ruby-keyword">self</span>.<span class="ruby-identifier">use_instantiated_fixtures</span> = :<span class="ruby-identifier">no_instances</span>
</pre>
</li></ul>

<p>Using either of these alternate methods incurs a performance hit, as the
fixtured data must be fully traversed in the database to create the fixture
hash and/or instance variables. This is expensive for large sets of
fixtured data.</p>

<h1 id="class-ActiveRecord::FixtureSet-label-Dynamic+fixtures+with+ERB">Dynamic fixtures with <a href="../ERB.html">ERB</a><span><a href="#class-ActiveRecord::FixtureSet-label-Dynamic+fixtures+with+ERB">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>Sometimes you don&#39;t care about the content of the fixtures as much as
you care about the volume. In these cases, you can mix <a
href="../ERB.html">ERB</a> in with your <a href="../YAML.html">YAML</a>
fixtures to create a bunch of fixtures for load testing, like:</p>

<pre>&lt;% 1.upto(1000) do |i| %&gt;
fix_&lt;%= i %&gt;:
  id: &lt;%= i %&gt;
  name: guy_&lt;%= i %&gt;
&lt;% end %&gt;</pre>

<p>This will create 1000 very simple fixtures.</p>

<p>Using <a href="../ERB.html">ERB</a>, you can also inject dynamic values
into your fixtures with inserts like <code>&lt;%=
Date.today.strftime(&quot;%Y-%m-%d&quot;) %&gt;</code>. This is however a
feature to be used with some caution. The point of fixtures are that
they&#39;re stable units of predictable sample data. If you feel that you
need to inject dynamic values, then perhaps you should reexamine whether
your application is properly testable. Hence, dynamic values in fixtures
are to be considered a code smell.</p>

<p>Helper methods defined in a fixture will not be available in other
fixtures, to prevent against unwanted inter-test dependencies. Methods used
by multiple fixtures should be defined in a module that is included in <a
href="FixtureSet.html#method-c-context_class">::context_class</a>.</p>
<ul><li>
<p>define a helper method in `test_helper.rb`</p>

<pre class="ruby"><span class="ruby-keyword">module</span> <span class="ruby-constant">FixtureFileHelpers</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">file_sha</span>(<span class="ruby-identifier">path</span>)
    <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA2</span>.<span class="ruby-identifier">hexdigest</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;test/fixtures&#39;</span>, <span class="ruby-identifier">path</span>)))
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">FixtureSet</span>.<span class="ruby-identifier">context_class</span>.<span class="ruby-identifier">include</span> <span class="ruby-constant">FixtureFileHelpers</span>
</pre>
</li><li>
<p>use the helper method in a fixture</p>

<pre>photo:
  name: kitten.png
  sha: &lt;%= file_sha &#39;files/kitten.png&#39; %&gt;</pre>
</li></ul>

<h1 id="class-ActiveRecord::FixtureSet-label-Transactional+Tests">Transactional Tests<span><a href="#class-ActiveRecord::FixtureSet-label-Transactional+Tests">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p><a href="../Test.html">Test</a> cases can use begin+rollback to isolate
their changes to the database instead of having to delete+insert for every
test case.</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">FooTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">TestCase</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">use_transactional_tests</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-identifier">test</span> <span class="ruby-string">&quot;godzilla&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Foo</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-constant">Foo</span>.<span class="ruby-identifier">destroy_all</span>
    <span class="ruby-identifier">assert</span> <span class="ruby-constant">Foo</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">test</span> <span class="ruby-string">&quot;godzilla aftermath&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Foo</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>If you preload your test database with all fixture data (probably in the
rake task) and use transactional tests, then you may omit all fixtures
declarations in your test cases since all the data&#39;s already there and
every case rolls back its changes.</p>

<p>In order to use instantiated fixtures with preloaded data, set
<code>self.pre_loaded_fixtures</code> to true. This will provide access to
fixture data for every table that has been loaded through fixtures
(depending on the value of <code>use_instantiated_fixtures</code>).</p>

<p>When <strong>not</strong> to use transactional tests:</p>
<ol><li>
<p>You&#39;re testing whether a transaction works correctly. Nested
transactions don&#39;t commit until all parent transactions commit,
particularly, the fixtures transaction which is begun in setup and rolled
back in teardown. Thus, you won&#39;t be able to verify the results of your
transaction until Active Record supports nested transactions or savepoints
(in progress).</p>
</li><li>
<p>Your database does not support transactions. Every Active Record database
supports transactions except MySQL MyISAM. Use InnoDB, MaxDB, or NDB
instead.</p>
</li></ol>

<h1 id="class-ActiveRecord::FixtureSet-label-Advanced+Fixtures"><a href="../vendor/bundle/ruby/2_4_0/gems/oj-3_4_0/pages/Advanced_md.html">Advanced</a> Fixtures<span><a href="#class-ActiveRecord::FixtureSet-label-Advanced+Fixtures">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>Fixtures that don&#39;t specify an ID get some extra features:</p>
<ul><li>
<p>Stable, autogenerated IDs</p>
</li><li>
<p>Label references for associations (belongs_to, has_one, has_many)</p>
</li><li>
<p>HABTM associations as inline lists</p>
</li></ul>

<p>There are some more advanced features available even if the id is
specified:</p>
<ul><li>
<p>Autofilled timestamp columns</p>
</li><li>
<p>Fixture label interpolation</p>
</li><li>
<p>Support for <a href="../YAML.html">YAML</a> defaults</p>
</li></ul>

<h2 id="class-ActiveRecord::FixtureSet-label-Stable-2C+Autogenerated+IDs">Stable, Autogenerated IDs<span><a href="#class-ActiveRecord::FixtureSet-label-Stable-2C+Autogenerated+IDs">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Here, have a monkey fixture:</p>

<pre>george:
  id: 1
  name: George the Monkey

reginald:
  id: 2
  name: Reginald the Pirate</pre>

<p>Each of these fixtures has two unique identifiers: one for the database and
one for the humans. Why don&#39;t we generate the primary key instead?
Hashing each fixture&#39;s label yields a consistent ID:</p>

<pre>george: # generated id: 503576764
  name: George the Monkey

reginald: # generated id: 324201669
  name: Reginald the Pirate</pre>

<p>Active Record looks at the fixture&#39;s model class, discovers the correct
primary key, and generates it right before inserting the fixture into the
database.</p>

<p>The generated ID for a given label is constant, so we can discover any
fixture&#39;s ID without loading anything, as long as we know the label.</p>

<h2 id="class-ActiveRecord::FixtureSet-label-Label+references+for+associations+-28belongs_to-2C+has_one-2C+has_many-29">Label references for associations (belongs_to, has_one, has_many)<span><a href="#class-ActiveRecord::FixtureSet-label-Label+references+for+associations+-28belongs_to-2C+has_one-2C+has_many-29">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Specifying foreign keys in fixtures can be very fragile, not to mention
difficult to read. Since Active Record can figure out the ID of any fixture
from its label, you can specify FK&#39;s by label instead of ID.</p>

<h3 id="class-ActiveRecord::FixtureSet-label-belongs_to">belongs_to<span><a href="#class-ActiveRecord::FixtureSet-label-belongs_to">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Let&#39;s break out some more monkeys and pirates.</p>

<pre>### in pirates.yml

reginald:
  id: 1
  name: Reginald the Pirate
  monkey_id: 1

### in monkeys.yml

george:
  id: 1
  name: George the Monkey
  pirate_id: 1</pre>

<p>Add a few more monkeys and pirates and break this into multiple files, and
it gets pretty hard to keep track of what&#39;s going on. Let&#39;s use
labels instead of IDs:</p>

<pre>### in pirates.yml

reginald:
  name: Reginald the Pirate
  monkey: george

### in monkeys.yml

george:
  name: George the Monkey
  pirate: reginald</pre>

<p>Pow! All is made clear. Active Record reflects on the fixture&#39;s model
class, finds all the <code>belongs_to</code> associations, and allows you
to specify a target <strong>label</strong> for the
<strong>association</strong> (monkey: george) rather than a target
<strong>id</strong> for the <strong>FK</strong> (<code>monkey_id:
1</code>).</p>

<h4 id="class-ActiveRecord::FixtureSet-label-Polymorphic+belongs_to">Polymorphic belongs_to<span><a href="#class-ActiveRecord::FixtureSet-label-Polymorphic+belongs_to">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>Supporting polymorphic relationships is a little bit more complicated,
since Active Record needs to know what type your association is pointing
at. Something like this should look familiar:</p>

<pre>### in fruit.rb

belongs_to :eater, polymorphic: true

### in fruits.yml

apple:
  id: 1
  name: apple
  eater_id: 1
  eater_type: Monkey</pre>

<p>Can we do better? You bet!</p>

<pre>apple:
  eater: george (Monkey)</pre>

<p>Just provide the polymorphic target type and Active Record will take care
of the rest.</p>

<h3 id="class-ActiveRecord::FixtureSet-label-has_and_belongs_to_many">has_and_belongs_to_many<span><a href="#class-ActiveRecord::FixtureSet-label-has_and_belongs_to_many">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p><a href="../Time.html">Time</a> to give our monkey some fruit.</p>

<pre>### in monkeys.yml

george:
  id: 1
  name: George the Monkey

### in fruits.yml

apple:
  id: 1
  name: apple

orange:
  id: 2
  name: orange

grape:
  id: 3
  name: grape

### in fruits_monkeys.yml

apple_george:
  fruit_id: 1
  monkey_id: 1

orange_george:
  fruit_id: 2
  monkey_id: 1

grape_george:
  fruit_id: 3
  monkey_id: 1</pre>

<p>Let&#39;s make the HABTM fixture go away.</p>

<pre>### in monkeys.yml

george:
  id: 1
  name: George the Monkey
  fruits: apple, orange, grape

### in fruits.yml

apple:
  name: apple

orange:
  name: orange

grape:
  name: grape</pre>

<p>Zap! No more fruits_monkeys.yml file. We&#39;ve specified the list of
fruits on George&#39;s fixture, but we could&#39;ve just as easily
specified a list of monkeys on each fruit. As with <code>belongs_to</code>,
Active Record reflects on the fixture&#39;s model class and discovers the
<code>has_and_belongs_to_many</code> associations.</p>

<h2 id="class-ActiveRecord::FixtureSet-label-Autofilled+Timestamp+Columns">Autofilled <a href="Timestamp.html">Timestamp</a> Columns<span><a href="#class-ActiveRecord::FixtureSet-label-Autofilled+Timestamp+Columns">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>If your table/model specifies any of Active Record&#39;s standard timestamp
columns (<code>created_at</code>, <code>created_on</code>,
<code>updated_at</code>, <code>updated_on</code>), they will automatically
be set to <code>Time.now</code>.</p>

<p>If you&#39;ve set specific values, they&#39;ll be left alone.</p>

<h2 id="class-ActiveRecord::FixtureSet-label-Fixture+label+interpolation">Fixture label interpolation<span><a href="#class-ActiveRecord::FixtureSet-label-Fixture+label+interpolation">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The label of the current fixture is always available as a column value:</p>

<pre>geeksomnia:
  name: Geeksomnia&#39;s Account
  subdomain: $LABEL
  email: $LABEL@email.com</pre>

<p>Also, sometimes (like when porting older join table fixtures) you&#39;ll
need to be able to get a hold of the identifier for a given label. <a
href="../ERB.html">ERB</a> to the rescue:</p>

<pre>george_reginald:
  monkey_id: &lt;%= ActiveRecord::FixtureSet.identify(:reginald) %&gt;
  pirate_id: &lt;%= ActiveRecord::FixtureSet.identify(:george) %&gt;</pre>

<h2 id="class-ActiveRecord::FixtureSet-label-Support+for+YAML+defaults">Support for <a href="../YAML.html">YAML</a> defaults<span><a href="#class-ActiveRecord::FixtureSet-label-Support+for+YAML+defaults">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>You can set and reuse defaults in your fixtures <a
href="../YAML.html">YAML</a> file. This is the same technique used in the
<code>database.yml</code> file to specify defaults:</p>

<pre>DEFAULTS: &amp;DEFAULTS
  created_on: &lt;%= 3.weeks.ago.to_s(:db) %&gt;

first:
  name: Smurf
  &lt;&lt;: *DEFAULTS

second:
  name: Fraggle
  &lt;&lt;: *DEFAULTS</pre>

<p>Any fixture labeled “DEFAULTS” is safely ignored.</p>

<h2 id="class-ActiveRecord::FixtureSet-label-Configure+the+fixture+model+class">Configure the fixture model class<span><a href="#class-ActiveRecord::FixtureSet-label-Configure+the+fixture+model+class">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>It&#39;s possible to set the fixture&#39;s model class directly in the <a
href="../YAML.html">YAML</a> file. This is helpful when fixtures are loaded
outside tests and <code>set_fixture_class</code> is not available (e.g.
when running <code>rails db:fixtures:load</code>).</p>

<pre>_fixture:
  model_class: User
david:
  name: David</pre>

<p>Any fixtures labeled “_fixture” are safely ignored.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="MAX_ID">MAX_ID
        
        <dd>
        
      
      </dl>
    </section>
    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-config" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">config</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-fixtures" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">fixtures</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-model_class" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">model_class</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-name" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">name</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-table_name" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">table_name</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-cache_fixtures" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cache_fixtures</span><span
            class="method-args">(connection, fixtures_map)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="cache_fixtures-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activerecord-5.1.5/lib/active_record/fixtures.rb, line 454</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cache_fixtures</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">fixtures_map</span>)
  <span class="ruby-identifier">cache_for_connection</span>(<span class="ruby-identifier">connection</span>).<span class="ruby-identifier">update</span>(<span class="ruby-identifier">fixtures_map</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-cache_for_connection" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cache_for_connection</span><span
            class="method-args">(connection)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="cache_for_connection-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activerecord-5.1.5/lib/active_record/fixtures.rb, line 438</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cache_for_connection</span>(<span class="ruby-identifier">connection</span>)
  <span class="ruby-identifier">@@all_cached_fixtures</span>[<span class="ruby-identifier">connection</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-cached_fixtures" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cached_fixtures</span><span
            class="method-args">(connection, keys_to_fetch = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="cached_fixtures-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activerecord-5.1.5/lib/active_record/fixtures.rb, line 446</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cached_fixtures</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">keys_to_fetch</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">keys_to_fetch</span>
    <span class="ruby-identifier">cache_for_connection</span>(<span class="ruby-identifier">connection</span>).<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">keys_to_fetch</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">cache_for_connection</span>(<span class="ruby-identifier">connection</span>).<span class="ruby-identifier">values</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-context_class" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">context_class</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Superclass for the evaluation contexts used by <a
href="../ERB.html">ERB</a> fixtures.</p>
          
          

          
          <div class="method-source-code" id="context_class-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activerecord-5.1.5/lib/active_record/fixtures.rb, line 581</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">context_class</span>
  <span class="ruby-ivar">@context_class</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-create_fixtures" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_fixtures</span><span
            class="method-args">(fixtures_directory, fixture_set_names, class_names = {}, config = ActiveRecord::Base) { |: connection| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="create_fixtures-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activerecord-5.1.5/lib/active_record/fixtures.rb, line 511</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">create_fixtures</span>(<span class="ruby-identifier">fixtures_directory</span>, <span class="ruby-identifier">fixture_set_names</span>, <span class="ruby-identifier">class_names</span> = {}, <span class="ruby-identifier">config</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>)
  <span class="ruby-identifier">fixture_set_names</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">fixture_set_names</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:to_s</span>)
  <span class="ruby-identifier">class_names</span> = <span class="ruby-constant">ClassCache</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">class_names</span>, <span class="ruby-identifier">config</span>

  <span class="ruby-comment"># FIXME: Apparently JK uses this.</span>
  <span class="ruby-identifier">connection</span> = <span class="ruby-identifier">block_given?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">yield</span> <span class="ruby-operator">:</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>

  <span class="ruby-identifier">files_to_read</span> = <span class="ruby-identifier">fixture_set_names</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">fs_name</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">fixture_is_cached?</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">fs_name</span>)
  }

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">files_to_read</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">disable_referential_integrity</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">fixtures_map</span> = {}

      <span class="ruby-identifier">fixture_sets</span> = <span class="ruby-identifier">files_to_read</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fs_name</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">klass</span> = <span class="ruby-identifier">class_names</span>[<span class="ruby-identifier">fs_name</span>]
        <span class="ruby-identifier">conn</span> = <span class="ruby-identifier">klass</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">connection</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">connection</span>
        <span class="ruby-identifier">fixtures_map</span>[<span class="ruby-identifier">fs_name</span>] = <span class="ruby-identifier">new</span>( <span class="ruby-comment"># ActiveRecord::FixtureSet.new</span>
          <span class="ruby-identifier">conn</span>,
          <span class="ruby-identifier">fs_name</span>,
          <span class="ruby-identifier">klass</span>,
          <span class="ruby-operator">::</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">fixtures_directory</span>, <span class="ruby-identifier">fs_name</span>))
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">update_all_loaded_fixtures</span> <span class="ruby-identifier">fixtures_map</span>

      <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">transaction</span>(<span class="ruby-identifier">requires_new</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>) <span class="ruby-keyword">do</span>
        <span class="ruby-identifier">deleted_tables</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">h</span>, <span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span> }
        <span class="ruby-identifier">fixture_sets</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fs</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">conn</span> = <span class="ruby-identifier">fs</span>.<span class="ruby-identifier">model_class</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:connection</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">fs</span>.<span class="ruby-identifier">model_class</span>.<span class="ruby-identifier">connection</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">connection</span>
          <span class="ruby-identifier">table_rows</span> = <span class="ruby-identifier">fs</span>.<span class="ruby-identifier">table_rows</span>

          <span class="ruby-identifier">table_rows</span>.<span class="ruby-identifier">each_key</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">table</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">unless</span> <span class="ruby-identifier">deleted_tables</span>[<span class="ruby-identifier">conn</span>].<span class="ruby-identifier">include?</span> <span class="ruby-identifier">table</span>
              <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">delete</span> <span class="ruby-node">&quot;DELETE FROM #{conn.quote_table_name(table)}&quot;</span>, <span class="ruby-string">&quot;Fixture Delete&quot;</span>
            <span class="ruby-keyword">end</span>
            <span class="ruby-identifier">deleted_tables</span>[<span class="ruby-identifier">conn</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">table</span>
          <span class="ruby-keyword">end</span>

          <span class="ruby-identifier">table_rows</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fixture_set_name</span>, <span class="ruby-identifier">rows</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">insert_fixture</span>(<span class="ruby-identifier">row</span>, <span class="ruby-identifier">fixture_set_name</span>)
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>

          <span class="ruby-comment"># Cap primary key sequences to max(pk).</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:reset_pk_sequence!</span>)
            <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">reset_pk_sequence!</span>(<span class="ruby-identifier">fs</span>.<span class="ruby-identifier">table_name</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">cache_fixtures</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">fixtures_map</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">cached_fixtures</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">fixture_set_names</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-fixture_is_cached-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">fixture_is_cached?</span><span
            class="method-args">(connection, table_name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="fixture_is_cached-3F-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activerecord-5.1.5/lib/active_record/fixtures.rb, line 442</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">fixture_is_cached?</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">table_name</span>)
  <span class="ruby-identifier">cache_for_connection</span>(<span class="ruby-identifier">connection</span>)[<span class="ruby-identifier">table_name</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-identify" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">identify</span><span
            class="method-args">(label, column_type = :integer)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a consistent, platform-independent identifier for
<code>label</code>. <a href="../Integer.html">Integer</a> identifiers are
values less than 2^30. UUIDs are RFC 4122 version 5 SHA-1 hashes.</p>
          
          

          
          <div class="method-source-code" id="identify-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activerecord-5.1.5/lib/active_record/fixtures.rb, line 572</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">identify</span>(<span class="ruby-identifier">label</span>, <span class="ruby-identifier">column_type</span> = <span class="ruby-value">:integer</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">column_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:uuid</span>
    <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">UUID</span>.<span class="ruby-identifier">uuid_v5</span>(<span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">UUID</span><span class="ruby-operator">::</span><span class="ruby-constant">OID_NAMESPACE</span>, <span class="ruby-identifier">label</span>.<span class="ruby-identifier">to_s</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">Zlib</span>.<span class="ruby-identifier">crc32</span>(<span class="ruby-identifier">label</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-operator">%</span> <span class="ruby-constant">MAX_ID</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-instantiate_all_loaded_fixtures" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">instantiate_all_loaded_fixtures</span><span
            class="method-args">(object, load_instances = true)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="instantiate_all_loaded_fixtures-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activerecord-5.1.5/lib/active_record/fixtures.rb, line 470</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">instantiate_all_loaded_fixtures</span>(<span class="ruby-identifier">object</span>, <span class="ruby-identifier">load_instances</span> = <span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">all_loaded_fixtures</span>.<span class="ruby-identifier">each_value</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fixture_set</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">instantiate_fixtures</span>(<span class="ruby-identifier">object</span>, <span class="ruby-identifier">fixture_set</span>, <span class="ruby-identifier">load_instances</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-instantiate_fixtures" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">instantiate_fixtures</span><span
            class="method-args">(object, fixture_set, load_instances = true)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="instantiate_fixtures-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activerecord-5.1.5/lib/active_record/fixtures.rb, line 458</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">instantiate_fixtures</span>(<span class="ruby-identifier">object</span>, <span class="ruby-identifier">fixture_set</span>, <span class="ruby-identifier">load_instances</span> = <span class="ruby-keyword">true</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">load_instances</span>
    <span class="ruby-identifier">fixture_set</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fixture_name</span>, <span class="ruby-identifier">fixture</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">begin</span>
        <span class="ruby-identifier">object</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-node">&quot;@#{fixture_name}&quot;</span>, <span class="ruby-identifier">fixture</span>.<span class="ruby-identifier">find</span>
      <span class="ruby-keyword">rescue</span> <span class="ruby-constant">FixtureClassNotFound</span>
        <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(connection, name, class_name, path, config = ActiveRecord::Base)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activerecord-5.1.5/lib/active_record/fixtures.rb, line 591</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">connection</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">class_name</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">config</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>)
  <span class="ruby-ivar">@name</span>     = <span class="ruby-identifier">name</span>
  <span class="ruby-ivar">@path</span>     = <span class="ruby-identifier">path</span>
  <span class="ruby-ivar">@config</span>   = <span class="ruby-identifier">config</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">model_class</span> = <span class="ruby-identifier">class_name</span>

  <span class="ruby-ivar">@fixtures</span> = <span class="ruby-identifier">read_fixture_files</span>(<span class="ruby-identifier">path</span>)

  <span class="ruby-ivar">@connection</span> = <span class="ruby-identifier">connection</span>

  <span class="ruby-ivar">@table_name</span> = (<span class="ruby-identifier">model_class</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:table_name</span>) <span class="ruby-operator">?</span>
                  <span class="ruby-identifier">model_class</span>.<span class="ruby-identifier">table_name</span> <span class="ruby-operator">:</span>
                  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">default_fixture_table_name</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">config</span>))
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-reset_cache" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reset_cache</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="reset_cache-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activerecord-5.1.5/lib/active_record/fixtures.rb, line 434</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">reset_cache</span>
  <span class="ruby-identifier">@@all_cached_fixtures</span>.<span class="ruby-identifier">clear</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-5B-5D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">[]</span><span
            class="method-args">(x)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="5B-5D-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activerecord-5.1.5/lib/active_record/fixtures.rb, line 607</span>
<span class="ruby-keyword">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-identifier">x</span>)
  <span class="ruby-identifier">fixtures</span>[<span class="ruby-identifier">x</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-5B-5D-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">[]=</span><span
            class="method-args">(k, v)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="5B-5D-3D-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activerecord-5.1.5/lib/active_record/fixtures.rb, line 611</span>
<span class="ruby-keyword">def</span> <span class="ruby-operator">[]=</span>(<span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span>)
  <span class="ruby-identifier">fixtures</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-each" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">each</span><span
            class="method-args">(&block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="each-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activerecord-5.1.5/lib/active_record/fixtures.rb, line 615</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">fixtures</span>.<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-size" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">size</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="size-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activerecord-5.1.5/lib/active_record/fixtures.rb, line 619</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">size</span>
  <span class="ruby-identifier">fixtures</span>.<span class="ruby-identifier">size</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-table_rows" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">table_rows</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a hash of rows to be inserted. The key is the table, the value is a
list of rows to insert to that table.</p>
          
          

          
          <div class="method-source-code" id="table_rows-source">
            <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.4.0/gems/activerecord-5.1.5/lib/active_record/fixtures.rb, line 625</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">table_rows</span>
  <span class="ruby-identifier">now</span> = <span class="ruby-identifier">config</span>.<span class="ruby-identifier">default_timezone</span> <span class="ruby-operator">==</span> <span class="ruby-value">:utc</span> <span class="ruby-operator">?</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">utc</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>

  <span class="ruby-comment"># allow a standard key to be used for doing defaults in YAML</span>
  <span class="ruby-identifier">fixtures</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&quot;DEFAULTS&quot;</span>)

  <span class="ruby-comment"># track any join tables we need to insert later</span>
  <span class="ruby-identifier">rows</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">h</span>, <span class="ruby-identifier">table</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">table</span>] = [] }

  <span class="ruby-identifier">rows</span>[<span class="ruby-identifier">table_name</span>] = <span class="ruby-identifier">fixtures</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">label</span>, <span class="ruby-identifier">fixture</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">row</span> = <span class="ruby-identifier">fixture</span>.<span class="ruby-identifier">to_hash</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">model_class</span>
      <span class="ruby-comment"># fill in timestamp columns if they aren&#39;t specified and the model is set to record_timestamps</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">model_class</span>.<span class="ruby-identifier">record_timestamps</span>
        <span class="ruby-identifier">timestamp_column_names</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c_name</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">row</span>[<span class="ruby-identifier">c_name</span>] = <span class="ruby-identifier">now</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">c_name</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># interpolate the fixture label</span>
      <span class="ruby-identifier">row</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">row</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;$LABEL&quot;</span>, <span class="ruby-identifier">label</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># generate a primary key if necessary</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_primary_key_column?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">row</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">primary_key_name</span>)
        <span class="ruby-identifier">row</span>[<span class="ruby-identifier">primary_key_name</span>] = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">FixtureSet</span>.<span class="ruby-identifier">identify</span>(<span class="ruby-identifier">label</span>, <span class="ruby-identifier">primary_key_type</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># Resolve enums</span>
      <span class="ruby-identifier">model_class</span>.<span class="ruby-identifier">defined_enums</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">values</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">name</span>)
          <span class="ruby-identifier">row</span>[<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">values</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">row</span>[<span class="ruby-identifier">name</span>], <span class="ruby-identifier">row</span>[<span class="ruby-identifier">name</span>])
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># If STI is used, find the correct subclass for association reflection</span>
      <span class="ruby-identifier">reflection_class</span> =
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">row</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">inheritance_column_name</span>)
          <span class="ruby-identifier">row</span>[<span class="ruby-identifier">inheritance_column_name</span>].<span class="ruby-identifier">constantize</span> <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">model_class</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">model_class</span>
        <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">reflection_class</span>.<span class="ruby-identifier">_reflections</span>.<span class="ruby-identifier">each_value</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">association</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">case</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">macro</span>
        <span class="ruby-keyword">when</span> <span class="ruby-value">:belongs_to</span>
          <span class="ruby-comment"># Do not replace association name with association foreign key if they are named the same</span>
          <span class="ruby-identifier">fk_name</span> = (<span class="ruby-identifier">association</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:foreign_key</span>] <span class="ruby-operator">||</span> <span class="ruby-node">&quot;#{association.name}_id&quot;</span>).<span class="ruby-identifier">to_s</span>

          <span class="ruby-keyword">if</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">fk_name</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">value</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">association</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>)
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">polymorphic?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp">/\s*\(([^\)]*)\)\s*$/</span>, <span class="ruby-string">&quot;&quot;</span>)
              <span class="ruby-comment"># support polymorphic belongs_to as &quot;label (Type)&quot;</span>
              <span class="ruby-identifier">row</span>[<span class="ruby-identifier">association</span>.<span class="ruby-identifier">foreign_type</span>] = <span class="ruby-node">$1</span>
            <span class="ruby-keyword">end</span>

            <span class="ruby-identifier">fk_type</span> = <span class="ruby-identifier">reflection_class</span>.<span class="ruby-identifier">type_for_attribute</span>(<span class="ruby-identifier">fk_name</span>).<span class="ruby-identifier">type</span>
            <span class="ruby-identifier">row</span>[<span class="ruby-identifier">fk_name</span>] = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">FixtureSet</span>.<span class="ruby-identifier">identify</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">fk_type</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">when</span> <span class="ruby-value">:has_many</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">association</span>.<span class="ruby-identifier">options</span>[<span class="ruby-value">:through</span>]
            <span class="ruby-identifier">add_join_records</span>(<span class="ruby-identifier">rows</span>, <span class="ruby-identifier">row</span>, <span class="ruby-constant">HasManyThroughProxy</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">association</span>))
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">row</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">rows</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://rdoc.github.io/rdoc">RDoc</a> 5.0.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

